<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>QuantLingo â€” Python Quantitative Trading Learning Platform</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>
<style>
*{box-sizing:border-box;margin:0;padding:0}
body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;background:#0a0f1e;color:#e2e8f0;line-height:1.6}
::-webkit-scrollbar{width:6px}::-webkit-scrollbar-thumb{background:#334155;border-radius:3px}
.pulse{animation:pulse 2s cubic-bezier(.4,0,.6,1) infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-6px)}}
@keyframes glow{0%,100%{box-shadow:0 0 5px rgba(16,185,129,0.3)}50%{box-shadow:0 0 20px rgba(16,185,129,0.6)}}
@keyframes slideUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
@keyframes candleGrow{from{transform:scaleY(0)}to{transform:scaleY(1)}}
@media(max-width:900px){.g2{grid-template-columns:1fr!important}}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const{useState,useEffect,useRef,useCallback}=React;

const I=({n,s=16})=>{const d={
Play:'M5 3l14 9-14 9V3z',Rotate:'M1 4v6h6M3.51 15a9 9 0 1 0 2.13-9.36L1 10',
Bulb:'M9 18h6M10 22h4M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14',
Check:'M22 11.08V12a10 10 0 1 1-5.93-9.14M22 4L12 14.01l-3-3',
Lock:'M7 11V7a5 5 0 0 1 10 0v4M3 11h18v11H3z',
Trophy:'M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18M4 22h16M18 2H6v7a6 6 0 0 0 12 0V2Z',
Flame:'M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.07-2.14-.22-4.05 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.15.43-2.29 1-3a2.5 2.5 0 0 0 2.5 2.5z',
Chat:'M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z',
Send:'M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z',Settings:'M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2zM12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6z',X:'M18 6L6 18M6 6l12 12',
Eye:'M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8zM12 9a3 3 0 1 0 0 6 3 3 0 0 0 0-6z',
Book:'M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2zM22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z',
Code:'M16 18l6-6-6-6M8 6l-6 6 6 6',Right:'M9 18l6-6-6-6',Left:'M15 18l-6-6 6-6',
Star:'M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14l-5-4.87 6.91-1.01L12 2z',
Globe:'M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20zM2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z',
Home:'M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z',
Grid:'M10 3H3v7h7V3zM21 3h-7v7h7V3zM21 14h-7v7h7v-7zM10 14H3v7h7v-7z',
Arrow:'M5 12h14M12 5l7 7-7 7',
TrendUp:'M23 6l-9.5 9.5-5-5L1 18',
BarChart:'M12 20V10M18 20V4M6 20v-4'
};return d[n]?<svg width={s} height={s} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d={d[n]}/></svg>:null;};

const getKey=()=>localStorage.getItem('ql-api-key')||'';
const hasKey=()=>!!getKey();
const PROXY_URL='https://scrape-lingo-proxy.shengyishu666.workers.dev';
const callAPI=async(body)=>{
  const k=getKey();
  if(!k)throw new Error('No API key');
  const r=await fetch(PROXY_URL,{
    method:'POST',
    headers:{'Content-Type':'application/json','x-api-key':k},
    body:JSON.stringify(body)
  });
  if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error(e.error?.message||'API error '+r.status)}
  return r.json();
};

const LANGS=[
{code:'en',label:'English',flag:'ğŸ‡¬ğŸ‡§'},{code:'zh',label:'ä¸­æ–‡',flag:'ğŸ‡¨ğŸ‡³'},
{code:'es',label:'EspaÃ±ol',flag:'ğŸ‡ªğŸ‡¸'},{code:'fr',label:'FranÃ§ais',flag:'ğŸ‡«ğŸ‡·'},
{code:'ja',label:'æ—¥æœ¬èª',flag:'ğŸ‡¯ğŸ‡µ'},{code:'ko',label:'í•œêµ­ì–´',flag:'ğŸ‡°ğŸ‡·'},
{code:'pt',label:'PortuguÃªs',flag:'ğŸ‡§ğŸ‡·'},{code:'de',label:'Deutsch',flag:'ğŸ‡©ğŸ‡ª'}];

const UI={
en:{learn:'Learn',practice:'Practice',hint:'Hint',hide:'Hide',solutions:'Solutions',viewSol:'ğŸ“– View Solution',yourOut:'Your output',bestPractice:'âœ¨ Best Practice:',review:'Review',run:'Run',reset:'Reset',prev:'Previous',next:'Next',nextT:'Next Topic â†’',startEx:'Start Exercises',overall:'Overall',topics:'Topics',copy:'Copy to Editor',complete:'Complete all to continue',ex:'Exercise',of:'of',ask:'Ask anything...',tutor:'AI Tutor',think:'Thinking...',fail:'Connection failed. Try the hint!',showEn:'Show English',hideEn:'Hide English',transing:'Translating...',expected:'Expected output',tip:'ğŸ’¡ Tip:',correct:'ğŸ‰ Correct!',wrong:'âŒ Not quite right.',eval:'ğŸ¤” Evaluating...',courses:'Courses',back:'Back to Courses',progress:'Progress'},
zh:{learn:'å­¦ä¹ ',practice:'ç»ƒä¹ ',hint:'æç¤º',hide:'éšè—',solutions:'ç­”æ¡ˆ',viewSol:'ğŸ“– æŸ¥çœ‹è§£ç­”',yourOut:'ä½ çš„è¾“å‡º',bestPractice:'âœ¨ æœ€ä½³å®è·µï¼š',review:'å¤ä¹ ',run:'è¿è¡Œ',reset:'é‡ç½®',prev:'ä¸Šä¸€é¢˜',next:'ä¸‹ä¸€é¢˜',nextT:'ä¸‹ä¸€ä¸»é¢˜ â†’',startEx:'å¼€å§‹ç»ƒä¹ ',overall:'æ€»è¿›åº¦',topics:'ä¸»é¢˜',copy:'å¤åˆ¶åˆ°ç¼–è¾‘å™¨',complete:'å®Œæˆæ‰€æœ‰é¢˜ç›®ç»§ç»­',ex:'ç»ƒä¹ ',of:'/',ask:'éšä¾¿é—®...',tutor:'AI å¯¼å¸ˆ',think:'æ€è€ƒä¸­...',fail:'è¿æ¥å¤±è´¥ï¼Œè¯•è¯•æç¤ºï¼',showEn:'æ˜¾ç¤ºè‹±æ–‡',hideEn:'éšè—è‹±æ–‡',transing:'ç¿»è¯‘ä¸­...',expected:'æœŸæœ›è¾“å‡º',tip:'ğŸ’¡ æ”¹è¿›å»ºè®®ï¼š',correct:'ğŸ‰ æ­£ç¡®ï¼',wrong:'âŒ ä¸å¤ªå¯¹ã€‚',eval:'ğŸ¤” è¯„ä¼°ä¸­...',courses:'è¯¾ç¨‹',back:'è¿”å›è¯¾ç¨‹',progress:'è¿›åº¦'},
es:{learn:'Aprender',practice:'Practicar',hint:'Pista',hide:'Ocultar',solutions:'Soluciones',viewSol:'ğŸ“– Ver soluciÃ³n',yourOut:'Tu salida',bestPractice:'âœ¨ Mejor prÃ¡ctica:',review:'Revisar',run:'Ejecutar',reset:'Reiniciar',prev:'Anterior',next:'Siguiente',nextT:'Siguiente â†’',startEx:'Comenzar',overall:'Progreso',topics:'Temas',copy:'Copiar',complete:'Completa todo',ex:'Ejercicio',of:'de',ask:'Pregunta...',tutor:'Tutor IA',think:'Pensando...',fail:'ConexiÃ³n fallida!',showEn:'Mostrar inglÃ©s',hideEn:'Ocultar inglÃ©s',transing:'Traduciendo...',expected:'Salida esperada',tip:'ğŸ’¡ Consejo:',correct:'ğŸ‰ Â¡Correcto!',wrong:'âŒ No del todo.',eval:'ğŸ¤” Evaluando...',courses:'Cursos',back:'Volver',progress:'Progreso'},
fr:{learn:'Apprendre',practice:'Pratiquer',hint:'Indice',hide:'Cacher',solutions:'Solutions',viewSol:'ğŸ“– Voir la solution',yourOut:'Votre sortie',bestPractice:'âœ¨ Meilleure pratique:',review:'RÃ©viser',run:'ExÃ©cuter',reset:'RÃ©initialiser',prev:'PrÃ©cÃ©dent',next:'Suivant',nextT:'Suivant â†’',startEx:'Commencer',overall:'ProgrÃ¨s',topics:'Sujets',copy:'Copier',complete:'Terminez tout',ex:'Exercice',of:'sur',ask:'Demandez...',tutor:'Tuteur IA',think:'RÃ©flexion...',fail:'Ã‰chouÃ©e!',showEn:'Anglais',hideEn:'Cacher',transing:'Traduction...',expected:'Sortie attendue',tip:'ğŸ’¡ Conseil:',correct:'ğŸ‰ Correct!',wrong:'âŒ Pas tout Ã  fait.',eval:'ğŸ¤” Ã‰valuation...',courses:'Cours',back:'Retour',progress:'ProgrÃ¨s'},
ja:{learn:'å­¦ã¶',practice:'ç·´ç¿’',hint:'ãƒ’ãƒ³ãƒˆ',hide:'éè¡¨ç¤º',solutions:'è§£ç­”',viewSol:'ğŸ“– è§£ç­”ã‚’è¦‹ã‚‹',yourOut:'ã‚ãªãŸã®å‡ºåŠ›',bestPractice:'âœ¨ ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:',review:'å¾©ç¿’',run:'å®Ÿè¡Œ',reset:'ãƒªã‚»ãƒƒãƒˆ',prev:'å‰ã¸',next:'æ¬¡ã¸',nextT:'æ¬¡ â†’',startEx:'é–‹å§‹',overall:'é€²æ—',topics:'ãƒˆãƒ”ãƒƒã‚¯',copy:'ã‚³ãƒ”ãƒ¼',complete:'å…¨ã¦å®Œäº†ã—ã¦ç¶šè¡Œ',ex:'ç·´ç¿’',of:'/',ask:'èã„ã¦...',tutor:'AIãƒãƒ¥ãƒ¼ã‚¿ãƒ¼',think:'è€ƒãˆä¸­...',fail:'æ¥ç¶šå¤±æ•—ï¼',showEn:'è‹±èªè¡¨ç¤º',hideEn:'è‹±èªéè¡¨ç¤º',transing:'ç¿»è¨³ä¸­...',expected:'æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›',tip:'ğŸ’¡ ãƒ’ãƒ³ãƒˆ:',correct:'ğŸ‰ æ­£è§£ï¼',wrong:'âŒ æƒœã—ã„ã€‚',eval:'ğŸ¤” è©•ä¾¡ä¸­...',courses:'ã‚³ãƒ¼ã‚¹',back:'æˆ»ã‚‹',progress:'é€²æ—'},
ko:{learn:'í•™ìŠµ',practice:'ì—°ìŠµ',hint:'íŒíŠ¸',hide:'ìˆ¨ê¸°ê¸°',solutions:'ì •ë‹µ',viewSol:'ğŸ“– ì •ë‹µ ë³´ê¸°',yourOut:'ë‚´ ì¶œë ¥',bestPractice:'âœ¨ ëª¨ë²” ì‚¬ë¡€:',review:'ë³µìŠµ',run:'ì‹¤í–‰',reset:'ì´ˆê¸°í™”',prev:'ì´ì „',next:'ë‹¤ìŒ',nextT:'ë‹¤ìŒ â†’',startEx:'ì‹œì‘',overall:'ì§„í–‰ë¥ ',topics:'ì£¼ì œ',copy:'ë³µì‚¬',complete:'ëª¨ë‘ ì™„ë£Œí•˜ê³  ê³„ì†',ex:'ì—°ìŠµ',of:'/',ask:'ì§ˆë¬¸...',tutor:'AI íŠœí„°',think:'ìƒê° ì¤‘...',fail:'ì—°ê²° ì‹¤íŒ¨!',showEn:'ì˜ì–´',hideEn:'ìˆ¨ê¸°ê¸°',transing:'ë²ˆì—­ ì¤‘...',expected:'ì˜ˆìƒ ì¶œë ¥',tip:'ğŸ’¡ íŒ:',correct:'ğŸ‰ ì •ë‹µ!',wrong:'âŒ ì•„ì‰½ë„¤ìš”.',eval:'ğŸ¤” í‰ê°€ ì¤‘...',courses:'ì½”ìŠ¤',back:'ë’¤ë¡œ',progress:'ì§„í–‰ë¥ '},
pt:{learn:'Aprender',practice:'Praticar',hint:'Dica',hide:'Ocultar',solutions:'SoluÃ§Ãµes',viewSol:'ğŸ“– Ver soluÃ§Ã£o',yourOut:'Sua saÃ­da',bestPractice:'âœ¨ Melhor prÃ¡tica:',review:'Revisar',run:'Executar',reset:'Reiniciar',prev:'Anterior',next:'PrÃ³ximo',nextT:'PrÃ³ximo â†’',startEx:'Iniciar',overall:'Progresso',topics:'Temas',copy:'Copiar',complete:'Complete tudo',ex:'ExercÃ­cio',of:'de',ask:'Pergunte...',tutor:'Tutor IA',think:'Pensando...',fail:'Falhou!',showEn:'InglÃªs',hideEn:'Ocultar',transing:'Traduzindo...',expected:'SaÃ­da esperada',tip:'ğŸ’¡ Dica:',correct:'ğŸ‰ Correto!',wrong:'âŒ NÃ£o.',eval:'ğŸ¤” Avaliando...',courses:'Cursos',back:'Voltar',progress:'Progresso'},
de:{learn:'Lernen',practice:'Ãœben',hint:'Hinweis',hide:'Ausblenden',solutions:'LÃ¶sungen',viewSol:'ğŸ“– LÃ¶sung ansehen',yourOut:'Deine Ausgabe',bestPractice:'âœ¨ Best Practice:',review:'Wiederholen',run:'AusfÃ¼hren',reset:'ZurÃ¼cksetzen',prev:'ZurÃ¼ck',next:'Weiter',nextT:'NÃ¤chstes â†’',startEx:'Starten',overall:'Fortschritt',topics:'Themen',copy:'Kopieren',complete:'Alles abschlieÃŸen',ex:'Ãœbung',of:'von',ask:'Frag...',tutor:'KI-Tutor',think:'Denke...',fail:'Fehlgeschlagen!',showEn:'Englisch',hideEn:'Ausblenden',transing:'Ãœbersetze...',expected:'Erwartete Ausgabe',tip:'ğŸ’¡ Tipp:',correct:'ğŸ‰ Richtig!',wrong:'âŒ Nicht ganz.',eval:'ğŸ¤” Auswertung...',courses:'Kurse',back:'ZurÃ¼ck',progress:'Fortschritt'}
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ANIMATED DIAGRAM COMPONENTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const Diagrams={
'quant-overview':()=>{
  const[step,setStep]=React.useState(0);
  React.useEffect(()=>{const t=setInterval(()=>setStep(s=>(s+1)%5),2000);return()=>clearInterval(t)},[]);
  const steps=[
    {icon:'ğŸ“Š',label:'Data',desc:'Historical prices, volumes'},
    {icon:'ğŸ§®',label:'Strategy',desc:'Rules & signals'},
    {icon:'ğŸ¤–',label:'Backtest',desc:'Simulate on past data'},
    {icon:'âœ…',label:'Validate',desc:'Check profitability & risk'},
    {icon:'ğŸš€',label:'Execute',desc:'Automated trading'}
  ];
  return <div style={{background:'rgba(16,24,48,0.8)',borderRadius:12,padding:20,margin:'16px 0',border:'1px solid #1e3a5f'}}>
    <div style={{display:'flex',alignItems:'center',justifyContent:'center',gap:6,flexWrap:'wrap'}}>
      {steps.map((s,i)=><React.Fragment key={i}>
        <div style={{textAlign:'center',padding:12,borderRadius:8,background:i===step?'rgba(16,185,129,0.2)':'transparent',border:i===step?'2px solid #10b981':'2px solid transparent',transition:'all 0.5s',minWidth:85}}>
          <div style={{fontSize:26}}>{s.icon}</div>
          <div style={{color:i===step?'#6ee7b7':'#94a3b8',fontSize:11,fontWeight:600,marginTop:4}}>{s.label}</div>
          <div style={{color:'#64748b',fontSize:10}}>{s.desc}</div>
        </div>
        {i<4&&<div style={{color:i===step?'#10b981':'#1e3a5f',fontSize:16,transition:'color 0.5s'}}>â†’</div>}
      </React.Fragment>)}
    </div>
    <p style={{textAlign:'center',color:'#94a3b8',fontSize:12,marginTop:12}}>Quantitative Trading = Data + Math + Code â†’ Automated decisions</p>
  </div>
},

'market-participants':()=>{
  const ps=[
    {icon:'ğŸ¦',name:'Institutions',desc:'Banks, hedge funds, pension funds',size:'70% of volume',c:'#60a5fa'},
    {icon:'ğŸ¤–',name:'Algo Traders',desc:'Automated computer strategies',size:'60-70% of trades',c:'#a78bfa'},
    {icon:'ğŸ‘¤',name:'Retail',desc:'Individual investors like you!',size:'25% of volume',c:'#34d399'},
    {icon:'ğŸ›ï¸',name:'Market Makers',desc:'Provide liquidity, earn spread',size:'Always there',c:'#fbbf24'}
  ];
  return <div style={{background:'rgba(16,24,48,0.8)',borderRadius:12,padding:16,margin:'16px 0',border:'1px solid #1e3a5f'}}>
    <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(150px,1fr))',gap:10}}>
      {ps.map((p,i)=><div key={i} style={{background:'#0a0f1e',borderRadius:8,padding:10,border:'1px solid #1e293b',textAlign:'center'}}>
        <div style={{fontSize:24}}>{p.icon}</div>
        <div style={{color:p.c,fontWeight:600,fontSize:13}}>{p.name}</div>
        <div style={{color:'#94a3b8',fontSize:10,marginTop:4}}>{p.desc}</div>
        <div style={{color:'#64748b',fontSize:9,marginTop:4,padding:'2px 6px',background:'rgba(30,41,59,0.5)',borderRadius:4,display:'inline-block'}}>{p.size}</div>
      </div>)}
    </div>
  </div>
},

'candlestick-anatomy':()=>{
  const[show,setShow]=React.useState('bull');
  return <div style={{background:'rgba(16,24,48,0.8)',borderRadius:12,padding:20,margin:'16px 0',border:'1px solid #1e3a5f'}}>
    <div style={{display:'flex',gap:8,justifyContent:'center',marginBottom:16}}>
      {['bull','bear'].map(t=><button key={t} onClick={()=>setShow(t)} style={{padding:'4px 14px',borderRadius:6,fontSize:11,border:'none',cursor:'pointer',background:show===t?(t==='bull'?'#10b981':'#ef4444'):'#1e293b',color:show===t?'#fff':'#94a3b8',fontWeight:600}}>{t==='bull'?'ğŸ“ˆ Bullish (æ¶¨)':'ğŸ“‰ Bearish (è·Œ)'}</button>)}
    </div>
    <div style={{display:'flex',justifyContent:'center',alignItems:'center',gap:30}}>
      <svg width="120" height="200" viewBox="0 0 120 200">
        {show==='bull'?<>
          <line x1="60" y1="20" x2="60" y2="60" stroke="#10b981" strokeWidth="2"/>
          <rect x="30" y="60" width="60" height="80" fill="#10b981" rx="3"/>
          <line x1="60" y1="140" x2="60" y2="180" stroke="#10b981" strokeWidth="2"/>
          <text x="125" y="25" fill="#94a3b8" fontSize="10" textAnchor="start">â† High (æœ€é«˜ä»·)</text>
          <text x="125" y="65" fill="#6ee7b7" fontSize="10" textAnchor="start">â† Close (æ”¶ç›˜ä»·)</text>
          <text x="125" y="145" fill="#6ee7b7" fontSize="10" textAnchor="start">â† Open (å¼€ç›˜ä»·)</text>
          <text x="125" y="185" fill="#94a3b8" fontSize="10" textAnchor="start">â† Low (æœ€ä½ä»·)</text>
        </>:<>
          <line x1="60" y1="20" x2="60" y2="60" stroke="#ef4444" strokeWidth="2"/>
          <rect x="30" y="60" width="60" height="80" fill="#ef4444" rx="3"/>
          <line x1="60" y1="140" x2="60" y2="180" stroke="#ef4444" strokeWidth="2"/>
          <text x="125" y="25" fill="#94a3b8" fontSize="10" textAnchor="start">â† High (æœ€é«˜ä»·)</text>
          <text x="125" y="65" fill="#fca5a5" fontSize="10" textAnchor="start">â† Open (å¼€ç›˜ä»·)</text>
          <text x="125" y="145" fill="#fca5a5" fontSize="10" textAnchor="start">â† Close (æ”¶ç›˜ä»·)</text>
          <text x="125" y="185" fill="#94a3b8" fontSize="10" textAnchor="start">â† Low (æœ€ä½ä»·)</text>
        </>}
      </svg>
    </div>
    <p style={{textAlign:'center',color:'#94a3b8',fontSize:11,marginTop:12}}>{show==='bull'?'Green/hollow = price went UP (close > open)':'Red/filled = price went DOWN (close < open)'}</p>
  </div>
},

'return-calc':()=>{
  const[price1]=React.useState(100);
  const[price2,setPrice2]=React.useState(110);
  const ret=((price2-price1)/price1*100).toFixed(2);
  return <div style={{background:'rgba(16,24,48,0.8)',borderRadius:12,padding:20,margin:'16px 0',border:'1px solid #1e3a5f'}}>
    <div style={{display:'flex',alignItems:'center',justifyContent:'center',gap:16,flexWrap:'wrap'}}>
      <div style={{textAlign:'center'}}>
        <div style={{color:'#64748b',fontSize:10}}>Buy Price</div>
        <div style={{color:'#e2e8f0',fontSize:20,fontFamily:'monospace'}}>$100</div>
      </div>
      <div style={{color:'#64748b',fontSize:20}}>â†’</div>
      <div style={{textAlign:'center'}}>
        <div style={{color:'#64748b',fontSize:10}}>Sell Price</div>
        <input type="range" min="50" max="200" value={price2} onChange={e=>setPrice2(+e.target.value)} style={{width:120,accentColor:'#10b981'}}/>
        <div style={{color:'#e2e8f0',fontSize:20,fontFamily:'monospace'}}>${price2}</div>
      </div>
      <div style={{color:'#64748b',fontSize:20}}>=</div>
      <div style={{textAlign:'center'}}>
        <div style={{color:'#64748b',fontSize:10}}>Return</div>
        <div style={{color:ret>=0?'#10b981':'#ef4444',fontSize:24,fontWeight:700,fontFamily:'monospace'}}>{ret}%</div>
      </div>
    </div>
    <div style={{textAlign:'center',marginTop:10,fontFamily:'monospace',fontSize:11,color:'#64748b'}}>
      Return = (Sell - Buy) / Buy Ã— 100 = ({price2} - 100) / 100 Ã— 100
    </div>
  </div>
},

'risk-reward':()=>{
  const[step,setStep]=React.useState(0);
  React.useEffect(()=>{const t=setInterval(()=>setStep(s=>(s+1)%3),3000);return()=>clearInterval(t)},[]);
  const items=[
    {icon:'ğŸ¦',name:'Savings Account',ret:'2-5%',risk:'Very Low',c:'#60a5fa',bar:10},
    {icon:'ğŸ“ˆ',name:'Stock Market',ret:'8-12%',risk:'Medium',c:'#fbbf24',bar:50},
    {icon:'ğŸ¤–',name:'Quant Trading',ret:'15-30%+',risk:'High',c:'#ef4444',bar:85}
  ];
  return <div style={{background:'rgba(16,24,48,0.8)',borderRadius:12,padding:16,margin:'16px 0',border:'1px solid #1e3a5f'}}>
    <div style={{display:'flex',gap:10,justifyContent:'center',flexWrap:'wrap'}}>
      {items.map((x,i)=><div key={i} style={{flex:'1 1 140px',maxWidth:180,padding:12,borderRadius:8,background:i===step?'rgba(16,24,48,1)':'rgba(10,15,30,0.5)',border:`2px solid ${i===step?x.c:'#1e293b'}`,transition:'all 0.5s',textAlign:'center'}}>
        <div style={{fontSize:26}}>{x.icon}</div>
        <div style={{color:x.c,fontSize:12,fontWeight:600}}>{x.name}</div>
        <div style={{marginTop:6,background:'#0a0f1e',borderRadius:4,height:6,overflow:'hidden'}}>
          <div style={{width:x.bar+'%',height:'100%',background:x.c,borderRadius:4,transition:'width 1s'}}/>
        </div>
        <div style={{display:'flex',justifyContent:'space-between',marginTop:4}}>
          <span style={{color:'#6ee7b7',fontSize:10}}>Return: {x.ret}</span>
          <span style={{color:'#fca5a5',fontSize:10}}>Risk: {x.risk}</span>
        </div>
      </div>)}
    </div>
    <p style={{textAlign:'center',color:'#94a3b8',fontSize:11,marginTop:10}}>Higher return = Higher risk. Always understand the risk before investing!</p>
  </div>
},

'ma-crossover':()=>{
  const[frame,setFrame]=React.useState(0);
  React.useEffect(()=>{const t=setInterval(()=>setFrame(f=>(f+1)%60),150);return()=>clearInterval(t)},[]);
  const prices=[];const sma5=[];const sma20=[];
  for(let i=0;i<60;i++){prices.push(50+Math.sin(i*0.15)*15+Math.sin(i*0.05)*10+Math.random()*3)}
  for(let i=0;i<60;i++){
    if(i>=4){let s=0;for(let j=i-4;j<=i;j++)s+=prices[j];sma5.push(s/5)}else sma5.push(null);
    if(i>=19){let s=0;for(let j=i-19;j<=i;j++)s+=prices[j];sma20.push(s/20)}else sma20.push(null);
  }
  const toY=v=>(85-v)*2+10;
  const visible=Math.min(frame+20,60);
  return <div style={{background:'rgba(16,24,48,0.8)',borderRadius:12,padding:16,margin:'16px 0',border:'1px solid #1e3a5f'}}>
    <div style={{display:'flex',gap:16,justifyContent:'center',marginBottom:8,fontSize:11}}>
      <span style={{color:'#94a3b8'}}>â€” Price</span>
      <span style={{color:'#fbbf24'}}>â€” SMA(5) Fast</span>
      <span style={{color:'#818cf8'}}>â€” SMA(20) Slow</span>
    </div>
    <svg width="100%" viewBox="0 0 400 160" preserveAspectRatio="xMidYMid meet">
      <rect width="400" height="160" fill="transparent"/>
      {/* Grid */}
      {[30,50,70].map(v=><line key={v} x1="0" y1={toY(v)} x2="400" y2={toY(v)} stroke="#1e293b" strokeWidth="0.5"/>)}
      {/* Price line */}
      <polyline fill="none" stroke="#475569" strokeWidth="1.5" points={prices.slice(0,visible).map((p,i)=>`${i*6.8},${toY(p)}`).join(' ')}/>
      {/* SMA 5 */}
      <polyline fill="none" stroke="#fbbf24" strokeWidth="2" points={sma5.slice(0,visible).filter(v=>v!==null).map((p,i)=>`${(i+4)*6.8},${toY(p)}`).join(' ')}/>
      {/* SMA 20 */}
      <polyline fill="none" stroke="#818cf8" strokeWidth="2" points={sma20.slice(0,visible).filter(v=>v!==null).map((p,i)=>`${(i+19)*6.8},${toY(p)}`).join(' ')}/>
      {/* Crossover signals */}
      {sma5.slice(0,visible).map((v,i)=>{
        if(i<20||!v||!sma20[i]||!sma5[i-1]||!sma20[i-1])return null;
        if(sma5[i-1]<sma20[i-1]&&v>sma20[i])return <circle key={'b'+i} cx={i*6.8} cy={toY(v)} r="5" fill="#10b981" opacity="0.8"><title>BUY Signal</title></circle>;
        if(sma5[i-1]>sma20[i-1]&&v<sma20[i])return <circle key={'s'+i} cx={i*6.8} cy={toY(v)} r="5" fill="#ef4444" opacity="0.8"><title>SELL Signal</title></circle>;
        return null;
      })}
    </svg>
    <div style={{display:'flex',justifyContent:'center',gap:16,marginTop:8}}>
      <span style={{color:'#10b981',fontSize:11}}>ğŸŸ¢ Buy: Fast crosses ABOVE slow</span>
      <span style={{color:'#ef4444',fontSize:11}}>ğŸ”´ Sell: Fast crosses BELOW slow</span>
    </div>
  </div>
},

'backtest-flow':()=>{
  const[phase,setPhase]=React.useState(0);
  React.useEffect(()=>{const t=setInterval(()=>setPhase(p=>(p+1)%4),2500);return()=>clearInterval(t)},[]);
  const ph=[
    {i:'ğŸ“Š',l:'Historical Data',d:'Load 5+ years of OHLCV data',c:'#60a5fa'},
    {i:'ğŸ§®',l:'Apply Strategy',d:'Generate buy/sell signals',c:'#fbbf24'},
    {i:'ğŸ“ˆ',l:'Simulate Trades',d:'Track P&L for each trade',c:'#10b981'},
    {i:'ğŸ“‹',l:'Evaluate Results',d:'Sharpe, max drawdown, win rate',c:'#a78bfa'}
  ];
  return <div style={{background:'rgba(16,24,48,0.8)',borderRadius:12,padding:16,margin:'16px 0',border:'1px solid #1e3a5f'}}>
    <div style={{display:'flex',alignItems:'center',justifyContent:'center',gap:8,flexWrap:'wrap'}}>
      {ph.map((p,i)=><React.Fragment key={i}>
        <div style={{textAlign:'center',padding:10,borderRadius:8,background:i===phase?'rgba(16,185,129,0.15)':'transparent',border:i===phase?'2px solid '+p.c:'2px solid transparent',transition:'all 0.5s',minWidth:85}}>
          <div style={{fontSize:22}}>{p.i}</div>
          <div style={{color:p.c,fontSize:10,fontWeight:600}}>{p.l}</div>
          <div style={{color:'#64748b',fontSize:9}}>{p.d}</div>
        </div>
        {i<3&&<div style={{color:i===phase?'#10b981':'#1e3a5f',fontSize:14}}>â†’</div>}
      </React.Fragment>)}
    </div>
  </div>
},

'sharpe-visual':()=>{
  const strats=[
    {name:'Strategy A',ret:15,vol:10,sharpe:1.5,c:'#10b981'},
    {name:'Strategy B',ret:20,vol:25,sharpe:0.8,c:'#fbbf24'},
    {name:'Strategy C',ret:8,vol:5,sharpe:1.6,c:'#60a5fa'},
    {name:'S&P 500',ret:10,vol:15,sharpe:0.67,c:'#94a3b8'}
  ];
  return <div style={{background:'rgba(16,24,48,0.8)',borderRadius:12,padding:16,margin:'16px 0',border:'1px solid #1e3a5f'}}>
    <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(140px,1fr))',gap:8}}>
      {strats.map((s,i)=><div key={i} style={{background:'#0a0f1e',borderRadius:8,padding:10,border:'1px solid #1e293b',textAlign:'center'}}>
        <div style={{color:s.c,fontWeight:600,fontSize:12}}>{s.name}</div>
        <div style={{marginTop:6,fontSize:10,color:'#6ee7b7'}}>Return: {s.ret}%</div>
        <div style={{fontSize:10,color:'#fca5a5'}}>Volatility: {s.vol}%</div>
        <div style={{marginTop:6,padding:'4px 8px',borderRadius:4,background:s.sharpe>1?'rgba(16,185,129,0.2)':'rgba(251,191,36,0.2)',color:s.sharpe>1?'#10b981':'#fbbf24',fontWeight:700,fontSize:14}}>
          Sharpe: {s.sharpe.toFixed(2)}
        </div>
      </div>)}
    </div>
    <p style={{textAlign:'center',color:'#94a3b8',fontSize:11,marginTop:10}}>Sharpe Ratio = (Return - Risk-free Rate) / Volatility â†’ Higher is better!</p>
  </div>
},

'drawdown-visual':()=>{
  const vals=[100,105,110,108,115,120,112,105,98,95,100,108,115,120,125,118,122,128,130,135];
  let peak=vals[0];const dd=vals.map(v=>{peak=Math.max(peak,v);return((v-peak)/peak)*100});
  const toY=v=>80-v*0.5;const ddY=d=>40-d*2;
  return <div style={{background:'rgba(16,24,48,0.8)',borderRadius:12,padding:16,margin:'16px 0',border:'1px solid #1e3a5f'}}>
    <svg width="100%" viewBox="0 0 380 120" preserveAspectRatio="xMidYMid meet">
      <polyline fill="none" stroke="#10b981" strokeWidth="2" points={vals.map((v,i)=>`${i*19+10},${toY(v)}`).join(' ')}/>
      {dd.map((d,i)=>d<0?<rect key={i} x={i*19+5} y={40} width="10" height={Math.abs(d)*2} fill="rgba(239,68,68,0.4)" rx="1"/>:null)}
      <line x1="0" y1="40" x2="380" y2="40" stroke="#334155" strokeWidth="0.5" strokeDasharray="4"/>
      <text x="5" y="12" fill="#10b981" fontSize="9">Portfolio Value</text>
      <text x="5" y="52" fill="#ef4444" fontSize="9">Drawdown</text>
    </svg>
    <p style={{textAlign:'center',color:'#94a3b8',fontSize:11,marginTop:6}}>Max Drawdown = largest peak-to-trough decline. Keep it small!</p>
  </div>
},

'position-sizing':()=>{
  const[risk,setRisk]=React.useState(2);
  const capital=100000;
  const stopLoss=5;
  const posSize=(capital*risk/100)/(stopLoss/100);
  return <div style={{background:'rgba(16,24,48,0.8)',borderRadius:12,padding:16,margin:'16px 0',border:'1px solid #1e3a5f'}}>
    <div style={{display:'flex',alignItems:'center',justifyContent:'center',gap:20,flexWrap:'wrap'}}>
      <div style={{textAlign:'center'}}>
        <div style={{color:'#64748b',fontSize:10}}>Capital</div>
        <div style={{color:'#e2e8f0',fontSize:16,fontFamily:'monospace'}}>$100,000</div>
      </div>
      <div style={{textAlign:'center'}}>
        <div style={{color:'#64748b',fontSize:10}}>Risk per trade</div>
        <input type="range" min="0.5" max="5" step="0.5" value={risk} onChange={e=>setRisk(+e.target.value)} style={{width:80,accentColor:'#ef4444'}}/>
        <div style={{color:'#fca5a5',fontSize:16,fontWeight:700}}>{risk}%</div>
      </div>
      <div style={{textAlign:'center'}}>
        <div style={{color:'#64748b',fontSize:10}}>Stop Loss</div>
        <div style={{color:'#fbbf24',fontSize:16}}>5%</div>
      </div>
      <div style={{color:'#334155',fontSize:20}}>=</div>
      <div style={{textAlign:'center'}}>
        <div style={{color:'#64748b',fontSize:10}}>Position Size</div>
        <div style={{color:'#10b981',fontSize:20,fontWeight:700}}>${posSize.toLocaleString()}</div>
      </div>
    </div>
    <div style={{textAlign:'center',marginTop:8,fontFamily:'monospace',fontSize:10,color:'#64748b'}}>
      Position = (Capital Ã— Risk%) / Stop% = ($100K Ã— {risk}%) / 5%
    </div>
  </div>
},

'strategy-types':()=>{
  const strats=[
    {name:'Trend Following',icon:'ğŸ“ˆ',desc:'Follow the trend: buy when up, sell when down',ex:'Moving Average Crossover',c:'#10b981'},
    {name:'Mean Reversion',icon:'ğŸ”„',desc:'Prices return to average: buy low, sell high',ex:'Bollinger Bands',c:'#60a5fa'},
    {name:'Momentum',icon:'ğŸš€',desc:'Strong moves continue: buy winners',ex:'RSI Breakout',c:'#fbbf24'},
    {name:'Statistical Arb',icon:'ğŸ“Š',desc:'Price relationships between assets',ex:'Pairs Trading',c:'#a78bfa'}
  ];
  return <div style={{background:'rgba(16,24,48,0.8)',borderRadius:12,padding:12,margin:'16px 0',border:'1px solid #1e3a5f'}}>
    <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(160px,1fr))',gap:8}}>
      {strats.map((s,i)=><div key={i} style={{background:'#0a0f1e',borderRadius:8,padding:10,border:'1px solid #1e293b'}}>
        <div style={{fontSize:22}}>{s.icon}</div>
        <div style={{color:s.c,fontWeight:600,fontSize:12}}>{s.name}</div>
        <div style={{color:'#94a3b8',fontSize:10,marginTop:4}}>{s.desc}</div>
        <div style={{color:'#64748b',fontSize:9,marginTop:4,fontStyle:'italic'}}>e.g. {s.ex}</div>
      </div>)}
    </div>
  </div>
},

'ohlcv-table':()=>{
  const rows=[
    {d:'2024-01-15',o:150.20,h:153.80,l:149.50,c:152.30,v:'45.2M'},
    {d:'2024-01-16',o:152.30,h:155.00,l:151.80,c:154.70,v:'38.1M'},
    {d:'2024-01-17',o:154.70,h:154.90,l:148.20,c:149.10,v:'62.5M'},
  ];
  return <div style={{background:'rgba(16,24,48,0.8)',borderRadius:12,padding:12,margin:'16px 0',border:'1px solid #1e3a5f',overflow:'auto'}}>
    <table style={{width:'100%',borderCollapse:'collapse',fontSize:11,fontFamily:'monospace'}}>
      <thead><tr>{['Date','Open','High','Low','Close','Volume'].map((h,i)=><th key={i} style={{padding:'6px 10px',color:'#94a3b8',borderBottom:'1px solid #1e293b',textAlign:i?'right':'left',fontSize:10}}>{h}</th>)}</tr></thead>
      <tbody>{rows.map((r,i)=><tr key={i}>{[r.d,r.o.toFixed(2),r.h.toFixed(2),r.l.toFixed(2),r.c.toFixed(2),r.v].map((v,j)=><td key={j} style={{padding:'6px 10px',color:j===0?'#60a5fa':j===4?(r.c>r.o?'#10b981':'#ef4444'):'#e2e8f0',borderBottom:'1px solid #0a0f1e',textAlign:j?'right':'left'}}>{j>0&&j<5?'$':''}{v}</td>)}</tr>)}</tbody>
    </table>
    <p style={{textAlign:'center',color:'#94a3b8',fontSize:10,marginTop:8}}>OHLCV = Open, High, Low, Close, Volume â€” the fundamental data for all trading analysis</p>
  </div>
},

'yfinance-demo':()=>{
  return <div style={{background:'rgba(16,24,48,0.8)',borderRadius:12,padding:16,margin:'16px 0',border:'1px solid #1e3a5f'}}>
    <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:10}}><span style={{fontSize:16}}>ğŸ</span><span style={{color:'#10b981',fontWeight:600,fontSize:13}}>yfinance Quick Start</span></div>
    <div style={{fontFamily:'monospace',fontSize:11,color:'#94a3b8',lineHeight:1.7}}>
      <div><span style={{color:'#c084fc'}}>import</span> yfinance <span style={{color:'#c084fc'}}>as</span> yf</div>
      <div style={{marginTop:6}}><span style={{color:'#64748b'}}># Download stock data</span></div>
      <div>stock = yf.Ticker(<span style={{color:'#34d399'}}>"AAPL"</span>)</div>
      <div>df = stock.history(period=<span style={{color:'#34d399'}}>"1y"</span>)</div>
      <div style={{marginTop:6}}><span style={{color:'#64748b'}}># Get price columns</span></div>
      <div>print(df[[<span style={{color:'#34d399'}}>'Open'</span>, <span style={{color:'#34d399'}}>'High'</span>, <span style={{color:'#34d399'}}>'Low'</span>, <span style={{color:'#34d399'}}>'Close'</span>, <span style={{color:'#34d399'}}>'Volume'</span>]])</div>
    </div>
  </div>
},

'indicator-comparison':()=>{
  const inds=[
    {name:'SMA',full:'Simple Moving Average',use:'Trend direction',calc:'Average of last N prices',c:'#fbbf24'},
    {name:'EMA',full:'Exponential Moving Average',use:'Recent trend (faster)',calc:'Weighted average (recent = more weight)',c:'#10b981'},
    {name:'RSI',full:'Relative Strength Index',use:'Overbought / Oversold',calc:'0-100 scale from gain/loss ratio',c:'#a78bfa'},
    {name:'MACD',full:'Moving Avg Convergence/Div',use:'Trend changes',calc:'Difference between 2 EMAs',c:'#60a5fa'},
    {name:'BB',full:'Bollinger Bands',use:'Volatility & reversal',calc:'SMA Â± 2 Ã— std deviation',c:'#f87171'}
  ];
  return <div style={{background:'rgba(16,24,48,0.8)',borderRadius:12,padding:12,margin:'16px 0',border:'1px solid #1e3a5f'}}>
    <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fit,minmax(150px,1fr))',gap:6}}>
      {inds.map((ind,i)=><div key={i} style={{background:'#0a0f1e',borderRadius:6,padding:8,border:'1px solid #1e293b'}}>
        <div style={{color:ind.c,fontWeight:700,fontSize:14}}>{ind.name}</div>
        <div style={{color:'#64748b',fontSize:9}}>{ind.full}</div>
        <div style={{color:'#6ee7b7',fontSize:10,marginTop:4}}>ğŸ“Œ {ind.use}</div>
        <div style={{color:'#94a3b8',fontSize:9,marginTop:2}}>ğŸ§® {ind.calc}</div>
      </div>)}
    </div>
  </div>
}
};

const DiagramSummary=({items})=><div style={{background:'linear-gradient(135deg,rgba(16,185,129,0.1),rgba(96,165,250,0.1))',borderRadius:12,padding:16,margin:'16px 0',border:'1px solid rgba(16,185,129,0.3)'}}>
  <div style={{display:'flex',alignItems:'center',gap:8,marginBottom:10}}><span style={{fontSize:16}}>ğŸ“‹</span><span style={{color:'#6ee7b7',fontWeight:600,fontSize:14}}>Summary</span></div>
  {items.map((it,i)=><div key={i} style={{display:'flex',alignItems:'flex-start',gap:8,marginBottom:5}}><span style={{color:'#10b981',flexShrink:0}}>âœ“</span><span style={{color:'#cbd5e1',fontSize:13}}>{it}</span></div>)}
</div>;


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COURSE DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const PRE_T={
"c:0:title":{"zh":"é‡‘èåŸºç¡€","es":"Fundamentos Financieros","fr":"Fondamentaux Financiers","ja":"é‡‘èåŸºç¤","ko":"ê¸ˆìœµ ê¸°ì´ˆ","pt":"Fundamentos Financeiros","de":"Finanzgrundlagen"},
"c:0:desc":{"zh":"ç†è§£å¸‚åœºè¿ä½œã€èµ„äº§ç±»å‹å’Œæ ¸å¿ƒé£é™©æŒ‡æ ‡ â€” é‡åŒ–äº¤æ˜“çš„åŸºçŸ³ã€‚","es":"Comprende los mercados, tipos de activos e indicadores clave de riesgo.","fr":"Comprendre les marchÃ©s, les types d'actifs et les indicateurs de risque.","ja":"å¸‚å ´ã®ä»•çµ„ã¿ã€è³‡ç”£ã‚¿ã‚¤ãƒ—ã€ãƒªã‚¹ã‚¯æŒ‡æ¨™ã‚’ç†è§£ã™ã‚‹ã€‚","ko":"ì‹œì¥, ìì‚° ìœ í˜•, í•µì‹¬ ë¦¬ìŠ¤í¬ ì§€í‘œë¥¼ ì´í•´í•©ë‹ˆë‹¤.","pt":"Entenda mercados, tipos de ativos e indicadores de risco.","de":"Verstehe MÃ¤rkte, Anlageklassen und Risikokennzahlen."},
"c:1:title":{"zh":"Python é‡‘èç¼–ç¨‹","es":"Python para Finanzas","fr":"Python pour la Finance","ja":"Pythoné‡‘èãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°","ko":"Python ê¸ˆìœµ í”„ë¡œê·¸ë˜ë°","pt":"Python para FinanÃ§as","de":"Python fÃ¼r Finanzen"},
"c:1:desc":{"zh":"ç”¨ yfinance è·å–æ•°æ®ã€pandas åˆ†æã€matplotlib å¯è§†åŒ– â€” é‡åŒ–åˆ†æå¸ˆçš„æ ¸å¿ƒå·¥å…·ã€‚","es":"yfinance para datos, pandas para anÃ¡lisis, matplotlib para visualizaciÃ³n.","fr":"yfinance pour les donnÃ©es, pandas pour l'analyse, matplotlib pour la visualisation.","ja":"yfinanceã§ãƒ‡ãƒ¼ã‚¿å–å¾—ã€pandasã§åˆ†æã€matplotlibã§å¯è¦–åŒ–ã€‚","ko":"yfinanceë¡œ ë°ì´í„° ìˆ˜ì§‘, pandasë¡œ ë¶„ì„, matplotlibë¡œ ì‹œê°í™”.","pt":"yfinance para dados, pandas para anÃ¡lise, matplotlib para visualizaÃ§Ã£o.","de":"yfinance fÃ¼r Daten, pandas fÃ¼r Analyse, matplotlib fÃ¼r Visualisierung."},
"c:2:title":{"zh":"æŠ€æœ¯æŒ‡æ ‡","es":"Indicadores TÃ©cnicos","fr":"Indicateurs Techniques","ja":"ãƒ†ã‚¯ãƒ‹ã‚«ãƒ«æŒ‡æ¨™","ko":"ê¸°ìˆ ì  ì§€í‘œ","pt":"Indicadores TÃ©cnicos","de":"Technische Indikatoren"},
"c:2:desc":{"zh":"ç§»åŠ¨å¹³å‡çº¿ã€RSIã€MACD â€” å­¦ä¼šç”¨ Python è®¡ç®—å’Œè§£è¯»å…³é”®äº¤æ˜“ä¿¡å·ã€‚","es":"Medias mÃ³viles, RSI, MACD â€” calcula e interpreta seÃ±ales de trading con Python.","fr":"Moyennes mobiles, RSI, MACD â€” calculez et interprÃ©tez les signaux de trading.","ja":"ç§»å‹•å¹³å‡ç·šã€RSIã€MACD â€” Pythonã§å£²è²·ã‚·ã‚°ãƒŠãƒ«ã‚’è¨ˆç®—ãƒ»è§£é‡ˆã€‚","ko":"ì´ë™í‰ê· ì„ , RSI, MACD â€” Pythonìœ¼ë¡œ íŠ¸ë ˆì´ë”© ì‹ í˜¸ë¥¼ ê³„ì‚°í•˜ê³  í•´ì„í•©ë‹ˆë‹¤.","pt":"MÃ©dias mÃ³veis, RSI, MACD â€” calcule e interprete sinais de trading com Python.","de":"Gleitende Durchschnitte, RSI, MACD â€” Handelssignale mit Python berechnen."},
"c:3:title":{"zh":"ç­–ç•¥å¼€å‘","es":"Desarrollo de Estrategias","fr":"DÃ©veloppement de StratÃ©gies","ja":"æˆ¦ç•¥é–‹ç™º","ko":"ì „ëµ ê°œë°œ","pt":"Desenvolvimento de EstratÃ©gias","de":"Strategieentwicklung"},
"c:3:desc":{"zh":"ä»ç­–ç•¥è®¾è®¡åˆ°å›æµ‹æ¡†æ¶ â€” æ„å»ºå’ŒéªŒè¯ä½ çš„äº¤æ˜“ç­–ç•¥ã€‚","es":"Del diseÃ±o de estrategias al backtesting â€” construye y valida tus estrategias.","fr":"De la conception au backtesting â€” construisez et validez vos stratÃ©gies.","ja":"æˆ¦ç•¥è¨­è¨ˆã‹ã‚‰ãƒãƒƒã‚¯ãƒ†ã‚¹ãƒˆã¾ã§ â€” å–å¼•æˆ¦ç•¥ã‚’æ§‹ç¯‰ãƒ»æ¤œè¨¼ã€‚","ko":"ì „ëµ ì„¤ê³„ë¶€í„° ë°±í…ŒìŠ¤íŒ…ê¹Œì§€ â€” íŠ¸ë ˆì´ë”© ì „ëµì„ êµ¬ì¶•í•˜ê³  ê²€ì¦í•©ë‹ˆë‹¤.","pt":"Do design ao backtesting â€” construa e valide suas estratÃ©gias.","de":"Vom Strategiedesign zum Backtesting â€” Handelsstrategien entwickeln und validieren."},
"c:4:title":{"zh":"é£é™©ç®¡ç†","es":"GestiÃ³n de Riesgos","fr":"Gestion des Risques","ja":"ãƒªã‚¹ã‚¯ç®¡ç†","ko":"ë¦¬ìŠ¤í¬ ê´€ë¦¬","pt":"GestÃ£o de Riscos","de":"Risikomanagement"},
"c:4:desc":{"zh":"ä»“ä½æ§åˆ¶ã€æ­¢æŸç­–ç•¥ã€èµ„é‡‘ç®¡ç† â€” ä¿æŠ¤ä½ çš„èµ„æœ¬æ˜¯ç¬¬ä¸€è¦åŠ¡ã€‚","es":"Control de posiciones, stop-loss, gestiÃ³n de capital â€” protege tu capital.","fr":"ContrÃ´le des positions, stop-loss, gestion du capital â€” protÃ©gez votre capital.","ja":"ãƒã‚¸ã‚·ãƒ§ãƒ³ç®¡ç†ã€ã‚¹ãƒˆãƒƒãƒ—ãƒ­ã‚¹ã€è³‡é‡‘ç®¡ç† â€” è³‡æœ¬ã‚’å®ˆã‚‹ã“ã¨ãŒæœ€å„ªå…ˆã€‚","ko":"í¬ì§€ì…˜ ê´€ë¦¬, ì†ì ˆë§¤, ìê¸ˆ ê´€ë¦¬ â€” ìë³¸ ë³´í˜¸ê°€ ìµœìš°ì„ ì…ë‹ˆë‹¤.","pt":"Controle de posiÃ§Ãµes, stop-loss, gestÃ£o de capital â€” proteja seu capital.","de":"Positionskontrolle, Stop-Loss, Kapitalmanagement â€” Kapitalschutz hat PrioritÃ¤t."},
"t:0:0:title":{"zh":"ä»€ä¹ˆæ˜¯é‡åŒ–äº¤æ˜“ï¼Ÿ","ja":"é‡çš„å–å¼•ã¨ã¯ï¼Ÿ","ko":"í€€íŠ¸ íŠ¸ë ˆì´ë”©ì´ë€?","es":"Â¿QuÃ© es el Trading Cuantitativo?","fr":"Qu'est-ce que le Trading Quantitatif ?","pt":"O que Ã© Trading Quantitativo?","de":"Was ist quantitativer Handel?"},
"t:0:1:title":{"zh":"å¸‚åœºä¸èµ„äº§ç±»å‹","ja":"å¸‚å ´ã¨è³‡ç”£ã‚¿ã‚¤ãƒ—","ko":"ì‹œì¥ê³¼ ìì‚° ìœ í˜•","es":"Mercados y Tipos de Activos","fr":"MarchÃ©s et Types d'Actifs","pt":"Mercados e Tipos de Ativos","de":"MÃ¤rkte & Anlageklassen"},
"t:0:2:title":{"zh":"æ”¶ç›Šç‡ã€é£é™©ä¸å…³é”®æŒ‡æ ‡","ja":"ãƒªã‚¿ãƒ¼ãƒ³ã€ãƒªã‚¹ã‚¯ã€ä¸»è¦æŒ‡æ¨™","ko":"ìˆ˜ìµë¥ , ë¦¬ìŠ¤í¬ & í•µì‹¬ ì§€í‘œ","es":"Rendimientos, Riesgo e Indicadores Clave","fr":"Rendements, Risque et Indicateurs ClÃ©s","pt":"Retornos, Risco e Indicadores Chave","de":"Renditen, Risiko & SchlÃ¼sselkennzahlen"},
"t:1:0:title":{"zh":"è·å–å¸‚åœºæ•°æ®","ja":"å¸‚å ´ãƒ‡ãƒ¼ã‚¿ã®å–å¾—","ko":"ì‹œì¥ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°","es":"Obtener Datos de Mercado","fr":"Obtenir des DonnÃ©es de MarchÃ©","pt":"Obtendo Dados de Mercado","de":"Marktdaten abrufen"},
"t:1:1:title":{"zh":"pandas é‡‘èåˆ†æ","ja":"pandasã§é‡‘èåˆ†æ","ko":"pandas ê¸ˆìœµ ë¶„ì„","es":"pandas para AnÃ¡lisis Financiero","fr":"pandas pour l'Analyse FinanciÃ¨re","pt":"pandas para AnÃ¡lise Financeira","de":"pandas fÃ¼r Finanzanalyse"},
"t:1:2:title":{"zh":"é‡‘èæ•°æ®å¯è§†åŒ–","ja":"é‡‘èãƒ‡ãƒ¼ã‚¿ã®å¯è¦–åŒ–","ko":"ê¸ˆìœµ ë°ì´í„° ì‹œê°í™”","es":"VisualizaciÃ³n de Datos Financieros","fr":"Visualisation des DonnÃ©es FinanciÃ¨res","pt":"VisualizaÃ§Ã£o de Dados Financeiros","de":"Finanzdaten visualisieren"},
"t:2:0:title":{"zh":"ç§»åŠ¨å¹³å‡çº¿ (SMA & EMA)","ja":"ç§»å‹•å¹³å‡ç·š (SMA & EMA)","ko":"ì´ë™í‰ê· ì„  (SMA & EMA)","es":"Medias MÃ³viles (SMA y EMA)","fr":"Moyennes Mobiles (SMA et EMA)","pt":"MÃ©dias MÃ³veis (SMA e EMA)","de":"Gleitende Durchschnitte (SMA & EMA)"},
"t:2:1:title":{"zh":"RSI â€” ç›¸å¯¹å¼ºå¼±æŒ‡æ ‡","ja":"RSI â€” ç›¸å¯¾åŠ›æŒ‡æ•°","ko":"RSI â€” ìƒëŒ€ê°•ë„ì§€ìˆ˜","es":"RSI â€” Ãndice de Fuerza Relativa","fr":"RSI â€” Indice de Force Relative","pt":"RSI â€” Ãndice de ForÃ§a Relativa","de":"RSI â€” Relative-StÃ¤rke-Index"},
"t:2:2:title":{"zh":"MACD â€” è¶‹åŠ¿ä¸åŠ¨é‡","ja":"MACD â€” ãƒˆãƒ¬ãƒ³ãƒ‰ã¨ãƒ¢ãƒ¡ãƒ³ã‚¿ãƒ ","ko":"MACD â€” ì¶”ì„¸ì™€ ëª¨ë©˜í…€","es":"MACD â€” Tendencia y Momento","fr":"MACD â€” Tendance et Momentum","pt":"MACD â€” TendÃªncia e Momentum","de":"MACD â€” Trend & Momentum"},
"t:3:0:title":{"zh":"ç­–ç•¥è®¾è®¡åŸåˆ™","ja":"æˆ¦ç•¥è¨­è¨ˆã®åŸå‰‡","ko":"ì „ëµ ì„¤ê³„ ì›ì¹™","es":"Principios de DiseÃ±o de Estrategias","fr":"Principes de Conception de StratÃ©gies","pt":"PrincÃ­pios de Design de EstratÃ©gias","de":"Prinzipien der Strategieentwicklung"},
"t:3:1:title":{"zh":"ğŸ† MA äº¤å‰ç­–ç•¥","ja":"ğŸ† MA ã‚¯ãƒ­ã‚¹æˆ¦ç•¥","ko":"ğŸ† MA êµì°¨ ì „ëµ","es":"ğŸ† Estrategia de Cruce de MA","fr":"ğŸ† StratÃ©gie de Croisement MA","pt":"ğŸ† EstratÃ©gia de Cruzamento de MA","de":"ğŸ† MA-Crossover-Strategie"},
"t:4:0:title":{"zh":"é£é™©ç®¡ç†åŸºç¡€","ja":"ãƒªã‚¹ã‚¯ç®¡ç†ã®åŸºç¤","ko":"ë¦¬ìŠ¤í¬ ê´€ë¦¬ ê¸°ì´ˆ","es":"Fundamentos de GestiÃ³n de Riesgos","fr":"Fondamentaux de la Gestion des Risques","pt":"Fundamentos de GestÃ£o de Riscos","de":"Grundlagen des Risikomanagements"}
};
const preT=(key,lang)=>PRE_T[key]?.[lang]||null;

const COURSES=[
// â•â•â• COURSE 1: Financial Fundamentals â•â•â•
{
id:'fin-basics',title:'Financial Fundamentals',icon:'ğŸ’°',color:'#10b981',
desc:'Understand markets, risk, and return â€” zero finance background needed.',
topics:[
// â”€â”€ Topic 1: What is Quantitative Trading? â”€â”€
{id:1001,title:"What is Quantitative Trading?",icon:"ğŸ¤–",
lessons:[
{title:"Trading Meets Math",content:"Imagine you want to buy and sell stocks to make money. Traditional traders watch charts, read news, and make gut decisions. **Quantitative traders** do something different â€” they use **math, data, and code** to make decisions.\n\n[[[diagram:quant-overview]]]\n\nThink of it like this:\n- **Traditional trading** = A chef who cooks by feel and taste\n- **Quantitative trading** = A chef who follows a precise recipe with exact measurements\n\nBoth can make great dishes (profits), but the quantitative approach is **repeatable, testable, and removes emotion**.\n\n**Why Python?**\nPython is the #1 language for quant trading because:\nâ€¢ Libraries like `pandas` and `numpy` handle financial data easily\nâ€¢ `yfinance` gives you free market data\nâ€¢ You can backtest strategies in minutes\nâ€¢ It's beginner-friendly â€” you don't need a CS degree!"},
{title:"Who Trades Quantitatively?",content:"You might think quant trading is only for Wall Street geniuses. Not true! Let's see who participates:\n\n[[[diagram:market-participants]]]\n\n**The truth:** Many successful quant traders are:\nâ€¢ Self-taught programmers\nâ€¢ People from non-finance backgrounds\nâ€¢ Students learning on weekends\n\nYou don't need:\nâ€¢ âŒ An MBA or finance degree\nâ€¢ âŒ $1 million to start\nâ€¢ âŒ To be a math genius\n\nYou DO need:\nâ€¢ âœ… Basic Python skills (we'll teach you!)\nâ€¢ âœ… Patience to learn step by step\nâ€¢ âœ… Willingness to test before risking real money\n\n**Important disclaimer:** Trading involves risk. This course teaches you the **skills and knowledge**, not financial advice. Never trade money you can't afford to lose!\n\n[[[diagram:summary:Quant trading uses data + math + code for decisions|||Python is the #1 language for quant trading|||You don't need a finance degree â€” just curiosity|||Backtesting lets you test strategies without risking money|||Trading involves risk â€” always test before using real money|||The goal: remove emotion, make data-driven decisions]]]"}
],
exercises:[
{title:"Quant vs Traditional",task:"Print 'quantitative' to indicate what type of trading uses code and math.",starterCode:"# What type of trading uses code?\n",expectedOutput:"quantitative",hint:"Just print the word",bestExplanation:"Quantitative trading relies on mathematical models and computer programs rather than intuition.",solutions:[{label:"â­ Best",code:"print('quantitative')",best:true}]},
{title:"Quant Trading Language",task:"Print the most popular programming language for quantitative trading.",starterCode:"# Most popular quant language?\n",expectedOutput:"Python",hint:"ğŸ",bestExplanation:"Python dominates quant trading due to its rich ecosystem: pandas, numpy, scipy, and many broker APIs.",solutions:[{label:"â­ Best",code:"print('Python')",best:true}]},
{title:"Key Advantage",task:"Print what quant trading removes from the decision process (one word).",starterCode:"# What does quant trading remove?\n",expectedOutput:"emotion",hint:"Fear and greed are the enemies of trading",bestExplanation:"By automating decisions with code, we remove emotional biases like fear (selling too early) and greed (holding too long).",solutions:[{label:"â­ Best",code:"print('emotion')",best:true}]}
]},

// â”€â”€ Topic 2: Markets & Assets â”€â”€
{id:1002,title:"Markets & Asset Types",icon:"ğŸ›ï¸",
lessons:[
{title:"What Are Financial Markets?",content:"A **financial market** is simply a place where people buy and sell financial assets. Think of it like a supermarket, but instead of groceries, you're trading stocks, bonds, currencies, etc.\n\n**Stock Market** (Equity Market)\n```\nApple (AAPL) = a piece of Apple Inc.\nBuy 1 share at $150 â†’ You own a tiny part of Apple\nApple grows â†’ Your share might be worth $180\n```\n\n**Common asset types:**\nâ€¢ **Stocks** â€” ownership in a company (AAPL, GOOGL, TSLA)\nâ€¢ **ETFs** â€” baskets of stocks (SPY = S&P 500, QQQ = Nasdaq 100)\nâ€¢ **Bonds** â€” lending money to governments/companies for interest\nâ€¢ **Forex** â€” currency pairs (EUR/USD, USD/JPY)\nâ€¢ **Crypto** â€” digital currencies (BTC, ETH)\nâ€¢ **Commodities** â€” gold, oil, wheat\n\n**For this course, we'll focus on stocks and ETFs** â€” they're the easiest to understand and have the most free data available."},
{title:"Reading Price Data (OHLCV)",content:"Every financial asset has price data recorded as **OHLCV** â€” this is the foundation of ALL trading analysis:\n\n[[[diagram:ohlcv-table]]]\n\n**What each column means:**\nâ€¢ **Open** â€” first price when market opens\nâ€¢ **High** â€” highest price during the day\nâ€¢ **Low** â€” lowest price during the day\nâ€¢ **Close** â€” last price when market closes (most important!)\nâ€¢ **Volume** â€” how many shares were traded\n\n**Why is Close the most important?**\nBecause it represents the final agreed-upon price for the day. Most technical indicators use close prices.\n\n**Volume tells a story:**\nâ€¢ High volume + price up = strong buying (bullish)\nâ€¢ High volume + price down = strong selling (bearish)\nâ€¢ Low volume = nobody cares about this move\n\n[[[diagram:candlestick-anatomy]]]\n\nCandlesticks are a visual way to show OHLCV data. Each candle = one time period (day, hour, minute).\n\n[[[diagram:summary:Financial markets let you buy/sell stocks, ETFs, bonds, forex, crypto|||OHLCV = Open, High, Low, Close, Volume â€” the basic price data|||Close price is the most important â€” most indicators use it|||Volume confirms price moves: high volume = strong signal|||Candlestick charts show OHLCV visually: green=up, red=down|||We'll focus on stocks & ETFs â€” easiest to learn with]]]"}
],
exercises:[
{title:"OHLCV Meaning",task:"Print what the 'C' in OHLCV stands for.",starterCode:"# What does C stand for?\n",expectedOutput:"Close",hint:"The last price of the day",bestExplanation:"Close is the final trading price for the period. It's the most commonly used price in technical analysis.",solutions:[{label:"â­ Best",code:"print('Close')",best:true}]},
{title:"Price Direction",task:"Given open=100 and close=105, print 'bullish' or 'bearish'.",starterCode:"open_price = 100\nclose_price = 105\n",expectedOutput:"bullish",hint:"If close > open, price went up",bestExplanation:"Close > Open means the price went up = bullish (green candle). Close < Open = bearish (red candle).",solutions:[{label:"â­ Best",code:"open_price = 100\nclose_price = 105\nprint('bullish' if close_price > open_price else 'bearish')",best:true}]},
{title:"Volume Signal",task:"High volume + price up. Print the market sentiment (one word).",starterCode:"# High volume + price up = ?\n",expectedOutput:"bullish",hint:"Strong buying pressure",bestExplanation:"High volume confirms the price move. High volume + price up = strong buying = bullish signal.",solutions:[{label:"â­ Best",code:"print('bullish')",best:true}]}
]},

// â”€â”€ Topic 3: Returns & Risk â”€â”€
{id:1003,title:"Returns, Risk & Key Metrics",icon:"ğŸ“Š",
lessons:[
{title:"Calculating Returns",content:"**Return** = how much money you made (or lost) as a percentage.\n\n[[[diagram:return-calc]]]\n\nDrag the slider above to see how different sell prices affect your return!\n\n```python\n# Simple return\nbuy_price = 100\nsell_price = 115\nreturn_pct = (sell_price - buy_price) / buy_price * 100\nprint(f\"Return: {return_pct}%\")  # Return: 15.0%\n```\n\n**Two types of returns:**\n\n**1. Simple Return** (æ—¥å¸¸ä½¿ç”¨)\n```python\nsimple_return = (new_price - old_price) / old_price\n```\n\n**2. Log Return** (é‡åŒ–äº¤æ˜“æ›´å¸¸ç”¨)\n```python\nimport numpy as np\nlog_return = np.log(new_price / old_price)\n```\n\n**Why log returns?** They have nice mathematical properties:\nâ€¢ They're additive across time (simple returns aren't)\nâ€¢ They're symmetric: +10% and -10% are equal in magnitude\nâ€¢ They follow a normal distribution better\n\n**In pandas (the real way):**\n```python\nimport pandas as pd\n\n# Daily returns for a stock\ndf['daily_return'] = df['Close'].pct_change()      # Simple\ndf['log_return'] = np.log(df['Close'] / df['Close'].shift(1))  # Log\n```"},
{title:"Understanding Risk",content:"**Risk** in finance = how much your returns bounce around (volatility).\n\n[[[diagram:risk-reward]]]\n\n**Standard Deviation** â€” the most common risk measure:\n```python\nimport numpy as np\n\nreturns = [0.02, -0.01, 0.03, -0.02, 0.015]\nvol = np.std(returns) * np.sqrt(252)  # Annualized volatility\nprint(f\"Annual volatility: {vol:.1%}\")\n```\n\n**Why Ã— âˆš252?** Because there are ~252 trading days per year. Daily volatility Ã— âˆš252 = annual volatility.\n\n**Key risk metrics:**\n\n**Sharpe Ratio** â€” risk-adjusted return (higher = better):\n```\nSharpe = (Return - Risk-free Rate) / Volatility\n```\n\n[[[diagram:sharpe-visual]]]\n\n**Max Drawdown** â€” worst peak-to-valley decline:\n\n[[[diagram:drawdown-visual]]]\n\nA good strategy should have:\nâ€¢ Sharpe Ratio > 1.0 (good), > 2.0 (excellent)\nâ€¢ Max Drawdown < 20% (manageable)\nâ€¢ Consistent returns, not just one lucky year\n\n[[[diagram:summary:Return = (Sell - Buy) / Buy Ã— 100|||Log returns are preferred in quant trading (additive, symmetric)|||Volatility (std deviation) measures risk|||Annualize daily vol: Ã— âˆš252 (trading days per year)|||Sharpe Ratio = Return / Risk â€” higher is better, >1 is good|||Max Drawdown = worst decline from peak â€” keep it small]]]"}
],
exercises:[
{title:"Simple Return",task:"Calculate and print the return (%) for buy=80, sell=100.",starterCode:"buy = 80\nsell = 100\n",expectedOutput:"25.0",hint:"(sell - buy) / buy * 100",bestExplanation:"Simple return: (100-80)/80 = 0.25 = 25%. This is the most intuitive return measure.",solutions:[{label:"â­ Best",code:"buy = 80\nsell = 100\nprint((sell - buy) / buy * 100)",best:true}]},
{title:"Loss Return",task:"Calculate return for buy=100, sell=85. Print with one decimal.",starterCode:"buy = 100\nsell = 85\n",expectedOutput:"-15.0",hint:"Negative means loss",bestExplanation:"(85-100)/100 = -0.15 = -15%. Negative returns are losses. Understanding losses is crucial for risk management.",solutions:[{label:"â­ Best",code:"buy = 100\nsell = 85\nprint(round((sell - buy) / buy * 100, 1))",best:true}]},
{title:"Trading Days",task:"Print the approximate number of trading days in a year.",starterCode:"# Trading days per year?\n",expectedOutput:"252",hint:"Weekends and holidays are excluded",bestExplanation:"~252 trading days/year (365 - weekends - holidays). Used to annualize daily metrics like volatility.",solutions:[{label:"â­ Best",code:"print(252)",best:true}]},
{title:"Sharpe Ratio",task:"Strategy: 12% return, 2% risk-free, 10% volatility. Print Sharpe ratio.",starterCode:"ret = 12\nrf = 2\nvol = 10\n",expectedOutput:"1.0",hint:"(return - risk_free) / volatility",bestExplanation:"Sharpe = (12-2)/10 = 1.0. This is a decent ratio. Above 1.0 is good, above 2.0 is excellent.",solutions:[{label:"â­ Best",code:"ret = 12\nrf = 2\nvol = 10\nprint((ret - rf) / vol)",best:true}]}
]}
]},

// â•â•â• COURSE 2: Python for Finance â•â•â•
{
id:'py-finance',title:'Python for Finance',icon:'ğŸ',color:'#fbbf24',
desc:'Get market data, analyze it with pandas, and visualize trends.',
topics:[
// â”€â”€ Topic 1: Getting Market Data â”€â”€
{id:2001,title:"Getting Market Data",icon:"ğŸ“¥",
lessons:[
{title:"yfinance â€” Free Market Data",content:"**yfinance** is a Python library that gives you free stock data from Yahoo Finance. Let's get started!\n\n**Install:**\n```python\npip install yfinance\n```\n\n[[[diagram:yfinance-demo]]]\n\n**Download historical data:**\n```python\nimport yfinance as yf\n\n# Get Apple stock data\naapl = yf.download('AAPL', start='2023-01-01', end='2024-01-01')\nprint(aapl.head())  # First 5 rows\nprint(aapl.shape)   # (rows, columns)\n```\n\n**Common tickers:**\nâ€¢ AAPL = Apple, GOOGL = Google, MSFT = Microsoft\nâ€¢ SPY = S&P 500 ETF, QQQ = Nasdaq 100 ETF\nâ€¢ ^GSPC = S&P 500 Index, ^DJI = Dow Jones\n\n**Different time periods:**\n```python\n# Last 1 month\ndf = yf.download('AAPL', period='1mo')\n\n# Last 5 years\ndf = yf.download('AAPL', period='5y')\n\n# Specific dates\ndf = yf.download('AAPL', start='2020-01-01', end='2024-12-31')\n\n# Multiple stocks at once!\ndf = yf.download(['AAPL', 'GOOGL', 'MSFT'], period='1y')\n```"},
{title:"Exploring Your Data",content:"Once you have the data, explore it like a detective:\n\n```python\nimport yfinance as yf\nimport pandas as pd\n\ndf = yf.download('AAPL', period='1y')\n\n# Basic info\nprint(df.shape)          # (252, 6) â†’ 252 trading days, 6 columns\nprint(df.columns)        # Open, High, Low, Close, Adj Close, Volume\nprint(df.index)          # Date index\n\n# Quick statistics\nprint(df['Close'].describe())\n# count    252.000000\n# mean     178.345000\n# std       12.456000  â† Volatility!\n# min      155.200000\n# max      199.800000\n\n# Check for missing data\nprint(df.isnull().sum())  # Should be 0 for most stocks\n```\n\n**Adjusted Close vs Close:**\n```python\n# Close = actual closing price\n# Adj Close = adjusted for dividends and stock splits\n# ALWAYS use Adj Close for analysis!\ndf['Close'] = df['Adj Close']  # Replace with adjusted\n```\n\n[[[diagram:summary:yfinance gives free stock data: yf.download('AAPL', period='1y')|||Common tickers: AAPL, GOOGL, SPY, QQQ|||Always use Adjusted Close for analysis (accounts for splits/dividends)|||.describe() shows mean, std, min, max â€” quick overview|||.isnull().sum() checks for missing data|||Download multiple stocks: yf.download(['AAPL','GOOGL'], period='1y')]]]"}
],
exercises:[
{title:"Import yfinance",task:"Print the correct import statement for yfinance.",starterCode:"# How to import yfinance?\n",expectedOutput:"import yfinance as yf",hint:"Convention: yf",bestExplanation:"The standard alias 'yf' is used by the entire quant community. Always use it for readability.",solutions:[{label:"â­ Best",code:"print('import yfinance as yf')",best:true}]},
{title:"Download Period",task:"Print the yfinance period string for 'one year'.",starterCode:"# Period for one year?\n",expectedOutput:"1y",hint:"Number + letter",bestExplanation:"yfinance periods: 1d, 5d, 1mo, 3mo, 6mo, 1y, 2y, 5y, 10y, ytd, max",solutions:[{label:"â­ Best",code:"print('1y')",best:true}]},
{title:"Apple Ticker",task:"Print the ticker symbol for Apple Inc.",starterCode:"# Apple's stock ticker?\n",expectedOutput:"AAPL",hint:"Four letters",bestExplanation:"AAPL is Apple's ticker on NASDAQ. Tickers are unique identifiers for publicly traded companies.",solutions:[{label:"â­ Best",code:"print('AAPL')",best:true}]}
]},

// â”€â”€ Topic 2: pandas for Finance â”€â”€
{id:2002,title:"pandas for Financial Analysis",icon:"ğŸ¼",
lessons:[
{title:"Working with Price DataFrames",content:"pandas is your Swiss Army knife for financial data. Let's master the key operations:\n\n```python\nimport pandas as pd\nimport numpy as np\n\n# Simulated stock data\nprices = pd.DataFrame({\n    'AAPL': [150, 152, 148, 155, 153, 158, 160],\n    'GOOGL': [2800, 2830, 2790, 2850, 2820, 2870, 2900]\n}, index=pd.date_range('2024-01-01', periods=7))\n\n# Daily returns\nreturns = prices.pct_change().dropna()\nprint(returns)\n\n# Cumulative returns (growth of $1)\ncum_returns = (1 + returns).cumprod()\nprint(cum_returns)\n\n# Rolling statistics (20-day moving average)\nprices['AAPL_SMA20'] = prices['AAPL'].rolling(20).mean()\n```\n\n**Key pandas methods for finance:**\n```python\ndf.pct_change()        # Daily returns (% change)\ndf.rolling(20).mean()  # Moving average\ndf.rolling(20).std()   # Rolling volatility\ndf.cummax()            # Running maximum (for drawdown)\ndf.shift(1)            # Previous day's value\ndf.resample('M').last() # Monthly data from daily\n```"},
{title:"Calculating Key Metrics",content:"Let's calculate the metrics that matter:\n\n```python\nimport numpy as np\nimport pandas as pd\n\n# Assuming 'returns' is a Series of daily returns\ndaily_returns = pd.Series([0.01, -0.005, 0.02, -0.01, 0.015, 0.008, -0.003])\n\n# â”€â”€ Annualized Return â”€â”€\nannual_return = daily_returns.mean() * 252\nprint(f\"Annual Return: {annual_return:.2%}\")\n\n# â”€â”€ Annualized Volatility â”€â”€\nannual_vol = daily_returns.std() * np.sqrt(252)\nprint(f\"Annual Volatility: {annual_vol:.2%}\")\n\n# â”€â”€ Sharpe Ratio â”€â”€\nrisk_free = 0.05  # 5% annual\nsharpe = (annual_return - risk_free) / annual_vol\nprint(f\"Sharpe Ratio: {sharpe:.2f}\")\n\n# â”€â”€ Max Drawdown â”€â”€\ncum_returns = (1 + daily_returns).cumprod()\npeak = cum_returns.cummax()\ndrawdown = (cum_returns - peak) / peak\nmax_dd = drawdown.min()\nprint(f\"Max Drawdown: {max_dd:.2%}\")\n\n# â”€â”€ Win Rate â”€â”€\nwin_rate = (daily_returns > 0).mean()\nprint(f\"Win Rate: {win_rate:.2%}\")\n```\n\n[[[diagram:summary:pct_change() calculates daily returns from prices|||rolling(N).mean() creates N-day moving average|||Annualize: meanÃ—252 for return, stdÃ—âˆš252 for volatility|||Sharpe = (Annual Return - Risk Free) / Annual Volatility|||Max Drawdown = min((cum_return - peak) / peak)|||Win Rate = proportion of positive return days]]]"}
],
exercises:[
{title:"Daily Return",task:"Calculate daily return: yesterday=100, today=102. Print as decimal.",starterCode:"yesterday = 100\ntoday = 102\n",expectedOutput:"0.02",hint:"(today - yesterday) / yesterday",bestExplanation:"pct_change() does this automatically in pandas, but understanding the manual formula is important.",solutions:[{label:"â­ Best",code:"yesterday = 100\ntoday = 102\nprint((today - yesterday) / yesterday)",best:true}]},
{title:"Cumulative Return",task:"$1 invested, returns: +10%, +5%, -3%. Print final value rounded to 4 decimals.",starterCode:"returns = [0.10, 0.05, -0.03]\n",expectedOutput:"1.1235",hint:"Multiply (1+r) for each return",bestExplanation:"Cumulative return: 1 Ã— 1.10 Ã— 1.05 Ã— 0.97 = 1.1235. This is compound growth.",solutions:[{label:"â­ Best",code:"returns = [0.10, 0.05, -0.03]\nvalue = 1\nfor r in returns:\n    value *= (1 + r)\nprint(round(value, 4))",best:true}]},
{title:"Win Rate",task:"Returns: [0.02, -0.01, 0.03, -0.02, 0.01]. Print win rate as percentage.",starterCode:"returns = [0.02, -0.01, 0.03, -0.02, 0.01]\n",expectedOutput:"60.0",hint:"Count positives / total Ã— 100",bestExplanation:"3 out of 5 are positive = 60% win rate. Even 55% win rate can be very profitable with proper risk management!",solutions:[{label:"â­ Best",code:"returns = [0.02, -0.01, 0.03, -0.02, 0.01]\nwins = sum(1 for r in returns if r > 0)\nprint(wins / len(returns) * 100)",best:true}]}
]},

// â”€â”€ Topic 3: Data Visualization â”€â”€
{id:2003,title:"Visualizing Financial Data",icon:"ğŸ“ˆ",
lessons:[
{title:"matplotlib for Finance",content:"Visualization is essential â€” you need to SEE your data before trading it.\n\n**Install:**\n```python\npip install matplotlib\n```\n\n**Basic price chart:**\n```python\nimport matplotlib.pyplot as plt\nimport yfinance as yf\n\ndf = yf.download('AAPL', period='1y')\n\nplt.figure(figsize=(12, 6))\nplt.plot(df.index, df['Close'], label='AAPL', color='#10b981')\nplt.title('Apple Stock Price')\nplt.xlabel('Date')\nplt.ylabel('Price ($)')\nplt.legend()\nplt.grid(alpha=0.3)\nplt.savefig('apple_price.png', dpi=150)\nplt.show()\n```\n\n**Price with Moving Averages:**\n```python\ndf['SMA_20'] = df['Close'].rolling(20).mean()\ndf['SMA_50'] = df['Close'].rolling(50).mean()\n\nplt.figure(figsize=(12, 6))\nplt.plot(df['Close'], label='Price', alpha=0.7)\nplt.plot(df['SMA_20'], label='SMA 20', color='orange')\nplt.plot(df['SMA_50'], label='SMA 50', color='purple')\nplt.legend()\nplt.title('AAPL with Moving Averages')\nplt.show()\n```\n\n**Volume bar chart:**\n```python\nfig, (ax1, ax2) = plt.subplots(2, 1, figsize=(12, 8),\n                                gridspec_kw={'height_ratios': [3, 1]})\n\nax1.plot(df['Close'])\nax1.set_ylabel('Price')\n\ncolors = ['green' if c > o else 'red' \n          for c, o in zip(df['Close'], df['Open'])]\nax2.bar(df.index, df['Volume'], color=colors, alpha=0.6)\nax2.set_ylabel('Volume')\n\nplt.tight_layout()\nplt.show()\n```"},
{title:"Advanced Visualization",content:"**Returns distribution:**\n```python\nreturns = df['Close'].pct_change().dropna()\n\nplt.figure(figsize=(10, 5))\nplt.hist(returns, bins=50, color='#10b981', alpha=0.7, edgecolor='black')\nplt.axvline(returns.mean(), color='red', linestyle='--', label=f'Mean: {returns.mean():.4f}')\nplt.title('Distribution of Daily Returns')\nplt.xlabel('Daily Return')\nplt.ylabel('Frequency')\nplt.legend()\nplt.show()\n```\n\n**Correlation heatmap (multiple stocks):**\n```python\nimport seaborn as sns\n\nstocks = yf.download(['AAPL', 'GOOGL', 'MSFT', 'AMZN'], period='1y')\nreturns = stocks['Close'].pct_change().dropna()\n\nplt.figure(figsize=(8, 6))\nsns.heatmap(returns.corr(), annot=True, cmap='RdYlGn', center=0)\nplt.title('Stock Return Correlations')\nplt.show()\n```\n\n**Drawdown chart:**\n```python\ncum = (1 + returns['AAPL']).cumprod()\npeak = cum.cummax()\ndrawdown = (cum - peak) / peak\n\nplt.figure(figsize=(12, 4))\nplt.fill_between(drawdown.index, drawdown, 0, color='red', alpha=0.3)\nplt.title('Drawdown Over Time')\nplt.ylabel('Drawdown %')\nplt.show()\n```\n\n[[[diagram:summary:matplotlib is the foundation for financial charts|||Always label axes, add titles, and use legends|||Price + SMA overlay is the most common chart|||Volume bars confirm price moves (green=up day, red=down day)|||Return distribution histogram shows risk profile|||Correlation heatmap helps with portfolio diversification]]]"}
],
exercises:[
{title:"Plot Library",task:"Print the standard matplotlib import statement.",starterCode:"# matplotlib import?\n",expectedOutput:"import matplotlib.pyplot as plt",hint:"Convention: plt",bestExplanation:"'plt' is the universal alias. Every finance tutorial, every quant library uses this convention.",solutions:[{label:"â­ Best",code:"print('import matplotlib.pyplot as plt')",best:true}]},
{title:"Figure Size",task:"Print the typical figure size tuple for a financial chart.",starterCode:"# Good figure size for charts?\n",expectedOutput:"(12, 6)",hint:"Wide and not too tall",bestExplanation:"(12, 6) is the standard for time series charts â€” wide enough to see trends, not too tall.",solutions:[{label:"â­ Best",code:"print((12, 6))",best:true}]},
{title:"SMA Calculation",task:"Calculate 3-day SMA of [10, 12, 11, 13, 15]. Print the value for day 3.",starterCode:"prices = [10, 12, 11, 13, 15]\n",expectedOutput:"11.0",hint:"Average of first 3 prices",bestExplanation:"SMA(3) at day 3 = (10+12+11)/3 = 11.0. The rolling window slides forward each day.",solutions:[{label:"â­ Best",code:"prices = [10, 12, 11, 13, 15]\nsma = (prices[0] + prices[1] + prices[2]) / 3\nprint(sma)",best:true}]}
]}
]},

// â•â•â• COURSE 3: Technical Indicators â•â•â•
{
id:'tech-indicators',title:'Technical Indicators',icon:'ğŸ“‰',color:'#a78bfa',
desc:'Master SMA, EMA, RSI, MACD, Bollinger Bands â€” the tools of quant traders.',
topics:[
// â”€â”€ Topic 1: Moving Averages â”€â”€
{id:3001,title:"Moving Averages (SMA & EMA)",icon:"ã€°ï¸",
lessons:[
{title:"Simple Moving Average (SMA)",content:"A **Moving Average** smooths out price noise to reveal the underlying trend. Think of it like looking at the forest instead of individual trees.\n\n**SMA (Simple Moving Average):**\n```\nSMA(5) = Average of last 5 closing prices\n```\n\n```python\nimport pandas as pd\nimport numpy as np\n\n# Manual SMA\nprices = pd.Series([10, 11, 12, 11, 13, 14, 13, 15, 16, 15])\nsma_3 = prices.rolling(window=3).mean()\nprint(sma_3)\n```\n\n**Common SMA periods:**\nâ€¢ **SMA(20)** â€” Short-term trend (about 1 month)\nâ€¢ **SMA(50)** â€” Medium-term trend (about 1 quarter)\nâ€¢ **SMA(200)** â€” Long-term trend (about 1 year)\n\n**Trading signal â€” Golden Cross / Death Cross:**\n\n[[[diagram:ma-crossover]]]\n\nâ€¢ **Golden Cross** ğŸŸ¢ â€” SMA(50) crosses ABOVE SMA(200) â†’ BUY signal\nâ€¢ **Death Cross** ğŸ”´ â€” SMA(50) crosses BELOW SMA(200) â†’ SELL signal"},
{title:"Exponential Moving Average (EMA)",content:"**EMA** gives more weight to recent prices â€” it reacts faster than SMA.\n\n```python\n# EMA in pandas â€” incredibly easy!\ndf['EMA_12'] = df['Close'].ewm(span=12).mean()\ndf['EMA_26'] = df['Close'].ewm(span=26).mean()\n```\n\n**SMA vs EMA comparison:**\nâ€¢ **SMA** = treats all prices equally â†’ smoother, slower to react\nâ€¢ **EMA** = recent prices matter more â†’ faster, but more noise\n\n**When to use which?**\nâ€¢ **SMA** for long-term trends (SMA 200)\nâ€¢ **EMA** for short-term trading signals (EMA 12, 26)\nâ€¢ **MACD** uses EMA (we'll learn this next!)\n\n[[[diagram:indicator-comparison]]]\n\n**Implementing a Moving Average strategy:**\n```python\nimport pandas as pd\nimport yfinance as yf\n\ndf = yf.download('AAPL', period='2y')\ndf['SMA_20'] = df['Close'].rolling(20).mean()\ndf['SMA_50'] = df['Close'].rolling(50).mean()\n\n# Generate signals\ndf['Signal'] = 0\ndf.loc[df['SMA_20'] > df['SMA_50'], 'Signal'] = 1   # Buy\ndf.loc[df['SMA_20'] < df['SMA_50'], 'Signal'] = -1  # Sell\n\nprint(df[['Close', 'SMA_20', 'SMA_50', 'Signal']].tail(10))\n```\n\n[[[diagram:summary:SMA = average of last N prices â€” smooths noise|||EMA = weighted average favoring recent prices â€” faster reaction|||Common periods: 20 (short), 50 (medium), 200 (long-term)|||Golden Cross: short MA crosses above long MA â†’ Buy|||Death Cross: short MA crosses below long MA â†’ Sell|||Use rolling(N).mean() for SMA, ewm(span=N).mean() for EMA]]]"}
],
exercises:[
{title:"SMA by Hand",task:"Calculate SMA(3) for the last 3 values of [10, 12, 14, 11, 13]. Print rounded to 2 decimals.",starterCode:"prices = [10, 12, 14, 11, 13]\n",expectedOutput:"12.67",hint:"Average of last 3: (14+11+13)/3",bestExplanation:"SMA(3) = average of last 3 values = (14+11+13)/3 = 12.67. The window 'rolls' forward each day.",solutions:[{label:"â­ Best",code:"prices = [10, 12, 14, 11, 13]\nsma = sum(prices[-3:]) / 3\nprint(round(sma, 2))",best:true}]},
{title:"Golden Cross",task:"SMA_50=150, SMA_200=148. Yesterday: SMA_50=147, SMA_200=148. Print signal.",starterCode:"# Today: SMA50 > SMA200, Yesterday: SMA50 < SMA200\n",expectedOutput:"Golden Cross",hint:"Short crossed above long",bestExplanation:"When the faster SMA crosses above the slower one, it signals a bullish trend change = Golden Cross.",solutions:[{label:"â­ Best",code:"print('Golden Cross')",best:true}]},
{title:"Signal Logic",task:"SMA20=105, SMA50=102. Print 1 for buy, -1 for sell.",starterCode:"sma20 = 105\nsma50 = 102\n",expectedOutput:"1",hint:"Short above long = buy",bestExplanation:"SMA20 > SMA50 means short-term trend is above long-term = bullish = buy signal (1).",solutions:[{label:"â­ Best",code:"sma20 = 105\nsma50 = 102\nprint(1 if sma20 > sma50 else -1)",best:true}]}
]},

// â”€â”€ Topic 2: RSI â”€â”€
{id:3002,title:"RSI â€” Relative Strength Index",icon:"ğŸ“Š",
lessons:[
{title:"Understanding RSI",content:"**RSI** measures the speed and magnitude of price changes. It oscillates between 0 and 100.\n\n**Key levels:**\nâ€¢ RSI > 70 â†’ **Overbought** (too expensive, might drop)\nâ€¢ RSI < 30 â†’ **Oversold** (too cheap, might rise)\nâ€¢ RSI â‰ˆ 50 â†’ Neutral\n\n**The formula (simplified):**\n```\nRS = Average Gain / Average Loss  (over N periods)\nRSI = 100 - (100 / (1 + RS))\n```\n\n**In Python:**\n```python\ndef calculate_rsi(prices, period=14):\n    delta = prices.diff()\n    \n    gain = delta.where(delta > 0, 0)\n    loss = (-delta).where(delta < 0, 0)\n    \n    avg_gain = gain.rolling(window=period).mean()\n    avg_loss = loss.rolling(window=period).mean()\n    \n    rs = avg_gain / avg_loss\n    rsi = 100 - (100 / (1 + rs))\n    return rsi\n\n# Usage\ndf['RSI'] = calculate_rsi(df['Close'])\n```\n\n**Trading with RSI:**\n```python\n# Buy when RSI drops below 30 (oversold)\ndf['buy_signal'] = df['RSI'] < 30\n\n# Sell when RSI rises above 70 (overbought)\ndf['sell_signal'] = df['RSI'] > 70\n```\n\n**Warning:** RSI alone is not enough! In strong trends, RSI can stay overbought/oversold for weeks. Always combine with other indicators.\n\n[[[diagram:summary:RSI measures momentum on a 0-100 scale|||RSI > 70 = overbought (potential sell), RSI < 30 = oversold (potential buy)|||Standard period is 14 days|||RS = Average Gain / Average Loss over N periods|||RSI can stay extreme in strong trends â€” don't use alone|||Combine RSI with moving averages for better signals]]]"}
],
exercises:[
{title:"RSI Level",task:"RSI is 25. Print 'oversold', 'neutral', or 'overbought'.",starterCode:"rsi = 25\n",expectedOutput:"oversold",hint:"Below 30 = oversold",bestExplanation:"RSI < 30 signals oversold conditions. The asset may be undervalued and due for a bounce.",solutions:[{label:"â­ Best",code:"rsi = 25\nif rsi < 30:\n    print('oversold')\nelif rsi > 70:\n    print('overbought')\nelse:\n    print('neutral')",best:true}]},
{title:"RSI Signal",task:"RSI=75. Print 1 for buy, -1 for sell, 0 for hold.",starterCode:"rsi = 75\n",expectedOutput:"-1",hint:"Above 70 = overbought = sell",bestExplanation:"RSI > 70 = overbought = sell signal (-1). The price may have risen too fast and could pull back.",solutions:[{label:"â­ Best",code:"rsi = 75\nif rsi > 70:\n    print(-1)\nelif rsi < 30:\n    print(1)\nelse:\n    print(0)",best:true}]},
{title:"Default Period",task:"Print the standard RSI lookback period.",starterCode:"# Standard RSI period?\n",expectedOutput:"14",hint:"Created by J. Welles Wilder in 1978",bestExplanation:"14 periods is the RSI standard set by its inventor Wilder. Some traders use 9 (faster) or 25 (slower).",solutions:[{label:"â­ Best",code:"print(14)",best:true}]}
]},

// â”€â”€ Topic 3: MACD â”€â”€
{id:3003,title:"MACD â€” Trend & Momentum",icon:"ğŸ“‰",
lessons:[
{title:"Understanding MACD",content:"**MACD** (Moving Average Convergence Divergence) combines trend and momentum into one powerful indicator.\n\n**Components:**\n1. **MACD Line** = EMA(12) - EMA(26)\n2. **Signal Line** = EMA(9) of the MACD Line\n3. **Histogram** = MACD Line - Signal Line\n\n**In Python:**\n```python\ndef calculate_macd(df, fast=12, slow=26, signal=9):\n    ema_fast = df['Close'].ewm(span=fast).mean()\n    ema_slow = df['Close'].ewm(span=slow).mean()\n    \n    macd_line = ema_fast - ema_slow\n    signal_line = macd_line.ewm(span=signal).mean()\n    histogram = macd_line - signal_line\n    \n    return macd_line, signal_line, histogram\n\ndf['MACD'], df['Signal'], df['Hist'] = calculate_macd(df)\n```\n\n**Trading signals:**\nâ€¢ **Buy** when MACD crosses ABOVE signal line (histogram turns positive)\nâ€¢ **Sell** when MACD crosses BELOW signal line (histogram turns negative)\nâ€¢ **Divergence** â€” price makes new high but MACD doesn't â†’ trend weakening\n\n```python\n# Generate signals\ndf['MACD_signal'] = 0\ndf.loc[df['MACD'] > df['Signal'], 'MACD_signal'] = 1  # Bullish\ndf.loc[df['MACD'] < df['Signal'], 'MACD_signal'] = -1 # Bearish\n```\n\n[[[diagram:summary:MACD = EMA(12) - EMA(26) measures trend momentum|||Signal Line = EMA(9) of MACD â€” the trigger|||Histogram = MACD - Signal â€” visual momentum|||Buy when MACD crosses above Signal (histogram goes positive)|||Sell when MACD crosses below Signal (histogram goes negative)|||MACD divergence from price warns of trend reversals]]]"}
],
exercises:[
{title:"MACD Calculation",task:"EMA_12=155, EMA_26=150. Print the MACD value.",starterCode:"ema_12 = 155\nema_26 = 150\n",expectedOutput:"5",hint:"MACD = EMA_fast - EMA_slow",bestExplanation:"MACD = EMA(12) - EMA(26) = 155 - 150 = 5. Positive MACD means short-term trend is above long-term.",solutions:[{label:"â­ Best",code:"ema_12 = 155\nema_26 = 150\nprint(ema_12 - ema_26)",best:true}]},
{title:"MACD Signal",task:"MACD=3, Signal_line=1. Print 'bullish' or 'bearish'.",starterCode:"macd = 3\nsignal = 1\n",expectedOutput:"bullish",hint:"MACD above signal = bullish",bestExplanation:"MACD > Signal Line = bullish momentum. The histogram would be positive (3-1=2).",solutions:[{label:"â­ Best",code:"macd = 3\nsignal = 1\nprint('bullish' if macd > signal else 'bearish')",best:true}]},
{title:"Histogram",task:"MACD=2.5, Signal=3.0. Print the histogram value.",starterCode:"macd = 2.5\nsignal = 3.0\n",expectedOutput:"-0.5",hint:"Histogram = MACD - Signal",bestExplanation:"Histogram = 2.5 - 3.0 = -0.5. Negative histogram = bearish momentum (MACD below signal).",solutions:[{label:"â­ Best",code:"macd = 2.5\nsignal = 3.0\nprint(macd - signal)",best:true}]}
]}
]},

// â•â•â• COURSE 4: Strategy Development â•â•â•
{
id:'strategies',title:'Building Trading Strategies',icon:'ğŸ§®',color:'#f87171',
desc:'Design, backtest, and evaluate real trading strategies from scratch.',
topics:[
// â”€â”€ Topic 1: Strategy Fundamentals â”€â”€
{id:4001,title:"Strategy Design Principles",icon:"ğŸ—ï¸",
lessons:[
{title:"Anatomy of a Trading Strategy",content:"Every trading strategy, no matter how complex, has the same basic components:\n\n[[[diagram:strategy-types]]]\n\n**The 5 components every strategy needs:**\n\n**1. Entry Signal** â€” When do you BUY?\n```python\n# Example: Buy when RSI < 30\nif rsi < 30:\n    action = 'BUY'\n```\n\n**2. Exit Signal** â€” When do you SELL?\n```python\n# Example: Sell when RSI > 70\nif rsi > 70:\n    action = 'SELL'\n```\n\n**3. Position Sizing** â€” How MUCH do you buy?\n```python\n# Risk 2% of capital per trade\nposition_size = capital * 0.02 / stop_loss_pct\n```\n\n**4. Risk Management** â€” How do you protect yourself?\n```python\n# Stop loss at 5% below entry\nstop_loss = entry_price * 0.95\n```\n\n**5. Universe** â€” WHAT do you trade?\n```python\n# S&P 500 stocks with volume > 1M\nuniverse = ['AAPL', 'GOOGL', 'MSFT', ...]\n```\n\n[[[diagram:position-sizing]]]"},
{title:"The Backtesting Framework",content:"**Backtesting** = testing your strategy on historical data to see if it would have worked.\n\n[[[diagram:backtest-flow]]]\n\n**A simple backtest framework:**\n```python\nimport pandas as pd\nimport numpy as np\nimport yfinance as yf\n\ndef simple_backtest(ticker, sma_fast=20, sma_slow=50):\n    # 1. Get data\n    df = yf.download(ticker, period='5y')\n    \n    # 2. Calculate indicators\n    df['SMA_fast'] = df['Close'].rolling(sma_fast).mean()\n    df['SMA_slow'] = df['Close'].rolling(sma_slow).mean()\n    \n    # 3. Generate signals\n    df['Signal'] = 0\n    df.loc[df['SMA_fast'] > df['SMA_slow'], 'Signal'] = 1\n    df.loc[df['SMA_fast'] < df['SMA_slow'], 'Signal'] = -1\n    \n    # 4. Calculate strategy returns\n    df['Market_Return'] = df['Close'].pct_change()\n    df['Strategy_Return'] = df['Market_Return'] * df['Signal'].shift(1)\n    \n    # 5. Evaluate\n    total_return = (1 + df['Strategy_Return'].dropna()).cumprod().iloc[-1] - 1\n    sharpe = df['Strategy_Return'].mean() / df['Strategy_Return'].std() * np.sqrt(252)\n    \n    print(f\"Total Return: {total_return:.2%}\")\n    print(f\"Sharpe Ratio: {sharpe:.2f}\")\n    return df\n\nresults = simple_backtest('AAPL')\n```\n\n**Critical: Why shift(1)?**\n```python\ndf['Signal'].shift(1)  # Use YESTERDAY's signal for TODAY's trade\n```\nBecause in real trading, you can only act on signals from BEFORE the current bar. Without shift, you'd be using future information (**look-ahead bias**)!\n\n[[[diagram:summary:Every strategy needs: Entry, Exit, Position Size, Risk Management, Universe|||Backtesting simulates your strategy on historical data|||Always use .shift(1) to avoid look-ahead bias|||Strategy return = market return Ã— signal from previous day|||Key metrics: Total Return, Sharpe Ratio, Max Drawdown, Win Rate|||Never trust a backtest 100% â€” past performance â‰  future results]]]"}
],
exercises:[
{title:"Look-ahead Bias",task:"Print the pandas method that prevents look-ahead bias by using previous day's signal.",starterCode:"# Method to use yesterday's value?\n",expectedOutput:"shift(1)",hint:"Shifts data by 1 row",bestExplanation:"shift(1) moves all values down by 1 row, so today's row gets yesterday's value. Critical for honest backtesting!",solutions:[{label:"â­ Best",code:"print('shift(1)')",best:true}]},
{title:"Strategy Return",task:"Market return=0.02, signal=1 (long). Print strategy return.",starterCode:"market_return = 0.02\nsignal = 1\n",expectedOutput:"0.02",hint:"Strategy return = market Ã— signal",bestExplanation:"Signal=1 means we're long (holding). Strategy return = 0.02 Ã— 1 = 0.02 (we capture the full gain).",solutions:[{label:"â­ Best",code:"market_return = 0.02\nsignal = 1\nprint(market_return * signal)",best:true}]},
{title:"Short Position",task:"Market return=0.03 (up 3%), signal=-1 (short). Print strategy return.",starterCode:"market_return = 0.03\nsignal = -1\n",expectedOutput:"-0.03",hint:"Shorting loses when market goes up",bestExplanation:"Signal=-1 means short (betting on decline). Market went UP 3%, so we LOST 3%. Short return = 0.03 Ã— -1 = -0.03.",solutions:[{label:"â­ Best",code:"market_return = 0.03\nsignal = -1\nprint(market_return * signal)",best:true}]}
]},

// â”€â”€ Topic 2: MA Crossover Strategy â”€â”€
{id:4002,title:"ğŸ† MA Crossover Strategy",icon:"ğŸ†",
lessons:[
{title:"Building the Complete Strategy",content:"Let's build a complete Moving Average Crossover strategy from scratch â€” the \"Hello World\" of quant trading!\n\n```python\nimport pandas as pd\nimport numpy as np\nimport yfinance as yf\nimport matplotlib.pyplot as plt\n\n# â•â• STEP 1: Get Data â•â•\ndf = yf.download('SPY', start='2019-01-01', end='2024-01-01')\n\n# â•â• STEP 2: Calculate Indicators â•â•\ndf['SMA_20'] = df['Close'].rolling(20).mean()\ndf['SMA_50'] = df['Close'].rolling(50).mean()\ndf = df.dropna()  # Remove NaN rows\n\n# â•â• STEP 3: Generate Signals â•â•\ndf['Signal'] = 0\ndf.loc[df['SMA_20'] > df['SMA_50'], 'Signal'] = 1   # Long\ndf.loc[df['SMA_20'] <= df['SMA_50'], 'Signal'] = -1  # Short/Cash\n\n# â•â• STEP 4: Calculate Returns â•â•\ndf['Market_Ret'] = df['Close'].pct_change()\ndf['Strat_Ret'] = df['Market_Ret'] * df['Signal'].shift(1)\n\n# â•â• STEP 5: Performance Metrics â•â•\ndf['Cum_Market'] = (1 + df['Market_Ret']).cumprod()\ndf['Cum_Strat'] = (1 + df['Strat_Ret']).cumprod()\n\n# Results\ntotal = df['Cum_Strat'].iloc[-1] - 1\nsharpe = df['Strat_Ret'].mean() / df['Strat_Ret'].std() * np.sqrt(252)\npeak = df['Cum_Strat'].cummax()\nmax_dd = ((df['Cum_Strat'] - peak) / peak).min()\n\nprint(f\"Strategy Total Return: {total:.2%}\")\nprint(f\"Sharpe Ratio: {sharpe:.2f}\")\nprint(f\"Max Drawdown: {max_dd:.2%}\")\n```\n\nThis is a REAL, working strategy! Try it with different parameters and tickers."},
{title:"Visualizing & Improving",content:"**Visualize the results:**\n```python\nfig, axes = plt.subplots(3, 1, figsize=(14, 10))\n\n# Price + MAs\naxes[0].plot(df['Close'], label='SPY', alpha=0.7)\naxes[0].plot(df['SMA_20'], label='SMA 20', color='orange')\naxes[0].plot(df['SMA_50'], label='SMA 50', color='purple')\naxes[0].legend()\naxes[0].set_title('Price & Moving Averages')\n\n# Cumulative Returns\naxes[1].plot(df['Cum_Market'], label='Buy & Hold', color='gray')\naxes[1].plot(df['Cum_Strat'], label='MA Strategy', color='green')\naxes[1].legend()\naxes[1].set_title('Cumulative Returns')\n\n# Drawdown\npeak = df['Cum_Strat'].cummax()\ndd = (df['Cum_Strat'] - peak) / peak\naxes[2].fill_between(dd.index, dd, 0, color='red', alpha=0.3)\naxes[2].set_title('Strategy Drawdown')\n\nplt.tight_layout()\nplt.show()\n```\n\n**Ideas to improve:**\nâ€¢ Add a filter: only trade when RSI confirms\nâ€¢ Try different MA periods (10/30, 20/100, etc.)\nâ€¢ Add a stop-loss to limit drawdowns\nâ€¢ Test on different stocks and time periods\nâ€¢ Add transaction costs (0.1% per trade)\n\n[[[diagram:summary:MA Crossover is the 'Hello World' of quant strategies|||5 steps: Data â†’ Indicators â†’ Signals â†’ Returns â†’ Metrics|||Always use shift(1) for signals to avoid look-ahead bias|||Compare strategy vs buy-and-hold to know if strategy adds value|||Visualize: Price+MAs, Cumulative Returns, Drawdown|||Improve: add filters (RSI), stop-losses, transaction costs]]]"}
],
exercises:[
{title:"Signal Value",task:"SMA_20=105, SMA_50=100. Print the signal (1 or -1).",starterCode:"sma_20 = 105\nsma_50 = 100\n",expectedOutput:"1",hint:"Fast above slow = long",bestExplanation:"SMA_20 > SMA_50 â†’ Fast MA is above slow MA â†’ Bullish â†’ Signal = 1 (Long).",solutions:[{label:"â­ Best",code:"sma_20 = 105\nsma_50 = 100\nprint(1 if sma_20 > sma_50 else -1)",best:true}]},
{title:"Total Return",task:"Starting value=1.0, ending cumulative=1.35. Print total return as %.",starterCode:"start = 1.0\nend = 1.35\n",expectedOutput:"35.0",hint:"(end - start) / start Ã— 100",bestExplanation:"Total return = (1.35 - 1.0)/1.0 Ã— 100 = 35%. The strategy gained 35% over the test period.",solutions:[{label:"â­ Best",code:"start = 1.0\nend = 1.35\nprint((end - start) / start * 100)",best:true}]}
]}
]},

// â•â•â• COURSE 5: Risk Management â•â•â•
{
id:'risk-mgmt',title:'Risk Management',icon:'ğŸ›¡ï¸',color:'#60a5fa',
desc:'Protect your capital â€” position sizing, stop-losses, and portfolio optimization.',
topics:[
// â”€â”€ Topic 1: Risk Fundamentals â”€â”€
{id:5001,title:"Risk Management Fundamentals",icon:"âš–ï¸",
lessons:[
{title:"Why Risk Management is #1",content:"The #1 rule of trading:\n\n**\"Don't lose money. Rule #2: Don't forget Rule #1.\"** â€” Warren Buffett\n\nYou can have the best strategy in the world, but without risk management, one bad trade can wipe you out.\n\n**Math of losses:**\n```\n-10% loss â†’ need +11% to break even\n-20% loss â†’ need +25% to break even\n-50% loss â†’ need +100% to break even\n-90% loss â†’ need +900% to break even!\n```\n\n```python\ndef recovery_needed(loss_pct):\n    \"\"\"How much gain needed to recover from a loss\"\"\"\n    remaining = 1 - loss_pct/100\n    recovery = (1/remaining - 1) * 100\n    return recovery\n\nfor loss in [10, 20, 30, 50, 75, 90]:\n    print(f\"-{loss}% loss â†’ need +{recovery_needed(loss):.1f}% to recover\")\n```\n\n**Key risk rules:**\n1. **Never risk more than 1-2% of capital per trade**\n2. **Always use stop-losses**\n3. **Diversify** â€” don't put all money in one stock\n4. **Size positions based on volatility**\n5. **Know your max drawdown tolerance**"},
{title:"Position Sizing & Stop Losses",content:"**Position Sizing** â€” how much to buy:\n\n[[[diagram:position-sizing]]]\n\n```python\ndef calculate_position_size(capital, risk_pct, stop_loss_pct):\n    \"\"\"Calculate position size based on risk tolerance\"\"\"\n    risk_amount = capital * risk_pct / 100\n    position = risk_amount / (stop_loss_pct / 100)\n    return position\n\n# Example: $100K capital, 2% risk, 5% stop loss\npos = calculate_position_size(100000, 2, 5)\nprint(f\"Position size: ${pos:,.0f}\")  # $40,000\n\n# Meaning: buy $40,000 worth of the stock\n# If it drops 5%, you lose $2,000 (= 2% of $100K)\n```\n\n**Stop Loss types:**\n```python\n# Fixed percentage stop\nstop_loss = entry_price * (1 - 0.05)  # 5% below entry\n\n# ATR-based stop (volatility adjusted)\natr = df['Close'].diff().abs().rolling(14).mean()  # Average True Range\nstop_loss = entry_price - 2 * atr.iloc[-1]  # 2 ATR below entry\n\n# Trailing stop (follows price up)\ntrailing_stop = df['Close'].rolling(20).max() * 0.95  # 5% below 20-day high\n```\n\n**Trailing stop is the best friend of trend followers** â€” it locks in profits while letting winners run!\n\n[[[diagram:summary:Never risk more than 1-2% of total capital per trade|||Position Size = (Capital Ã— Risk%) / Stop Loss%|||Stop losses protect against catastrophic losses|||ATR-based stops adapt to market volatility|||Trailing stops lock in profits as price moves in your favor|||Losses grow exponentially: -50% needs +100% to recover]]]"}
],
exercises:[
{title:"Recovery Math",task:"Lost 50% ($100K â†’ $50K). What % gain needed to get back to $100K?",starterCode:"current = 50000\ntarget = 100000\n",expectedOutput:"100.0",hint:"(target - current) / current Ã— 100",bestExplanation:"Need to go from $50K to $100K = 100% gain. This is why preventing large losses is critical!",solutions:[{label:"â­ Best",code:"current = 50000\ntarget = 100000\nprint((target - current) / current * 100)",best:true}]},
{title:"Position Size",task:"Capital=$50,000, risk=2%, stop=4%. Print position size.",starterCode:"capital = 50000\nrisk_pct = 2\nstop_pct = 4\n",expectedOutput:"25000.0",hint:"(capital Ã— risk%) / stop%",bestExplanation:"Position = (50000 Ã— 0.02) / 0.04 = $25,000. If stock drops 4%, we lose $1,000 = 2% of capital.",solutions:[{label:"â­ Best",code:"capital = 50000\nrisk_pct = 2\nstop_pct = 4\nposition = (capital * risk_pct / 100) / (stop_pct / 100)\nprint(position)",best:true}]},
{title:"Stop Loss Price",task:"Bought at $200, stop loss at 5% below. Print stop price.",starterCode:"entry = 200\nstop_pct = 5\n",expectedOutput:"190.0",hint:"entry Ã— (1 - stop/100)",bestExplanation:"Stop = 200 Ã— (1 - 0.05) = $190. If price drops to $190, auto-sell to limit losses.",solutions:[{label:"â­ Best",code:"entry = 200\nstop_pct = 5\nprint(entry * (1 - stop_pct / 100))",best:true}]}
]}
]}
];


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// PYTHON SIMULATOR (same as original)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const simPython=(code)=>{
  try{
    const lines=code.split('\n');const out=[];const env={};
    const ev=(expr,e)=>{
      expr=expr.trim();
      if(expr==='True')return true;if(expr==='False')return false;if(expr==='None')return null;
      if(/^-?\d+$/.test(expr))return parseInt(expr);
      if(/^-?\d+\.\d+$/.test(expr))return parseFloat(expr);
      if((expr.startsWith("'")&&expr.endsWith("'"))||(expr.startsWith('"')&&expr.endsWith('"')))return expr.slice(1,-1);
      if(expr.startsWith('[')&&expr.endsWith(']')){const inner=expr.slice(1,-1);if(!inner.trim())return[];return inner.split(',').map(x=>ev(x.trim(),e))}
      if(expr.startsWith('{')&&expr.endsWith('}')){
        const inner=expr.slice(1,-1).trim();if(!inner)return{};
        if(!inner.includes(':')){const items=inner.split(',').map(x=>ev(x.trim(),e));return new Set(items)}
        const obj={};const pairs=inner.split(',');
        for(const p of pairs){const[k,v]=p.split(':');obj[ev(k.trim(),e)]=ev(v.trim(),e)}
        return obj;
      }
      if(expr.startsWith('(')&&expr.endsWith(')')){const inner=expr.slice(1,-1);if(inner.includes(','))return inner.split(',').map(x=>ev(x.trim(),e));return ev(inner,e)}
      if(expr.includes(' if ')&&expr.includes(' else ')){const m=expr.match(/(.+)\s+if\s+(.+)\s+else\s+(.+)/);if(m)return ev(m[2],e)?ev(m[1],e):ev(m[3],e)}
      if(expr.includes(' and ')){const parts=expr.split(' and ');return parts.every(p=>ev(p.trim(),e))}
      if(expr.includes(' or ')){const parts=expr.split(' or ');return parts.some(p=>ev(p.trim(),e))}
      if(expr.startsWith('not ')){return !ev(expr.slice(4),e)}
      if(expr.includes(' in ')){const[a,b]=expr.split(' in ');const av=ev(a.trim(),e);const bv=ev(b.trim(),e);if(Array.isArray(bv))return bv.includes(av);if(typeof bv==='string')return bv.includes(av);if(typeof bv==='object')return av in bv;return false}
      if(e.hasOwnProperty(expr))return e[expr];
      // f-string
      if(expr.startsWith("f'")&&expr.endsWith("'")||expr.startsWith('f"')&&expr.endsWith('"')){
        const s=expr.slice(2,-1);return s.replace(/\{([^}]+)\}/g,(_,x)=>{
          const fm=x.match(/^(.+):(.+)$/);if(fm){const v=ev(fm[1],e);const fmt=fm[2];if(fmt.endsWith('%'))return(v*100).toFixed(parseInt(fmt)||0)+'%';if(fmt.includes('f'))return parseFloat(v).toFixed(parseInt(fmt.match(/\.(\d+)/)?.[1]||2));if(fmt.includes(','))return Number(v).toLocaleString();return String(v)}
          const v=ev(x,e);return typeof v==='string'?v:pyStr(v);
        });
      }
      // Arithmetic
      const addSub=expr.match(/^(.+?)\s*([\+\-])\s*([^+\-].*)$/);
      if(addSub){const l=ev(addSub[1],e);const r=ev(addSub[3],e);return addSub[2]==='+'?(typeof l==='string'?l+r:l+r):l-r}
      const mulDiv=expr.match(/^(.+?)\s*([*/%])\s*(.+)$/);
      if(mulDiv){const l=ev(mulDiv[1],e);const r=ev(mulDiv[3],e);if(mulDiv[2]==='*')return typeof l==='string'?l.repeat(r):l*r;if(mulDiv[2]==='/')return l/r;return l%r}
      const pow=expr.match(/^(.+?)\s*\*\*\s*(.+)$/);
      if(pow)return Math.pow(ev(pow[1],e),ev(pow[2],e));
      // Method calls
      const mc=expr.match(/^(.+)\.(\w+)\(([^)]*)\)$/);
      if(mc){const obj=ev(mc[1],e);const meth=mc[2];const args=mc[3]?mc[3].split(',').map(a=>ev(a.trim(),e)):[];
        if(typeof obj==='string'){if(meth==='upper')return obj.toUpperCase();if(meth==='lower')return obj.toLowerCase();if(meth==='strip'||meth==='trim')return obj.trim();if(meth==='split')return args[0]?obj.split(args[0]):obj.split(/\s+/);if(meth==='replace')return obj.replace(new RegExp(args[0],'g'),args[1]||'');if(meth==='startswith')return obj.startsWith(args[0]);if(meth==='endswith')return obj.endsWith(args[0]);if(meth==='count')return obj.split(args[0]).length-1;if(meth==='find')return obj.indexOf(args[0]);if(meth==='join')return args[0].join(obj);if(meth==='format')return obj.replace(/\{\}/g,()=>args.shift())}
        if(Array.isArray(obj)){if(meth==='append'){obj.push(args[0]);return}if(meth==='pop')return obj.pop();if(meth==='sort'){obj.sort((a,b)=>a-b);return}if(meth==='reverse'){obj.reverse();return}if(meth==='index')return obj.indexOf(args[0]);if(meth==='count')return obj.filter(x=>x===args[0]).length;if(meth==='copy')return[...obj]}
        if(typeof obj==='object'&&obj!==null){if(meth==='get')return obj.hasOwnProperty(args[0])?obj[args[0]]:(args[1]!==undefined?args[1]:null);if(meth==='keys')return Object.keys(obj);if(meth==='values')return Object.values(obj);if(meth==='items')return Object.entries(obj);if(meth==='update'){Object.assign(obj,args[0]);return}if(typeof obj[meth]==='function')return obj[meth](...args)}
      }
      // Property
      const prop=expr.match(/^(.+)\.(\w+)$/);
      if(prop){const obj=ev(prop[1],e);if(typeof obj==='string'&&prop[2]==='length')return obj.length;if(Array.isArray(obj)&&prop[2]==='length')return obj.length}
      // Built-in functions
      const fn_match=expr.match(/^(\w+)\((.+)\)$/);
      if(fn_match){const fn=fn_match[1];const arg=ev(fn_match[2],e);
        if(fn==='int')return parseInt(arg);if(fn==='float')return parseFloat(arg);if(fn==='str')return String(arg);if(fn==='bool')return!!arg;
        if(fn==='len')return typeof arg==='string'?arg.length:(Array.isArray(arg)?arg.length:Object.keys(arg).length);
        if(fn==='type'){if(typeof arg==='number')return Number.isInteger(arg)?"<class 'int'>":"<class 'float'>";if(typeof arg==='string')return"<class 'str'>";if(Array.isArray(arg))return"<class 'list'>";return"<class '"+typeof arg+"'>"}
        if(fn==='min')return Array.isArray(arg)?Math.min(...arg):Math.min(...Object.values(arguments));
        if(fn==='max')return Array.isArray(arg)?Math.max(...arg):Math.max(...Object.values(arguments));
        if(fn==='sum')return Array.isArray(arg)?arg.reduce((a,b)=>a+b,0):0;
        if(fn==='abs')return Math.abs(arg);if(fn==='round')return Math.round(arg);
        if(fn==='sorted')return[...arg].sort((a,b)=>a-b);
        if(fn==='list'){if(arg instanceof Set)return[...arg];return Array.isArray(arg)?[...arg]:[arg]}
        if(fn==='set')return new Set(arg);
        if(fn==='range'){if(typeof arg==='number'){const r=[];for(let i=0;i<arg;i++)r.push(i);return r}}
      }
      const rng=expr.match(/^range\((.+)\)$/);
      if(rng){const args=rng[1].split(',').map(a=>ev(a.trim(),e));const r=[];if(args.length===1)for(let i=0;i<args[0];i++)r.push(i);else if(args.length===2)for(let i=args[0];i<args[1];i++)r.push(i);else if(args.length===3)for(let i=args[0];args[2]>0?i<args[1]:i>args[1];i+=args[2])r.push(i);return r}
      const idx=expr.match(/^(.+)\[(.+)\]$/);
      if(idx){const o=ev(idx[1],e);const i=ev(idx[2],e);return o[i<0?o.length+i:i]}
      if(expr.includes('==')){const[a,b]=expr.split('==');return ev(a,e)===ev(b,e)}
      if(expr.includes('!=')){const[a,b]=expr.split('!=');return ev(a,e)!==ev(b,e)}
      if(expr.includes('>=')){const[a,b]=expr.split('>=');return ev(a,e)>=ev(b,e)}
      if(expr.includes('<=')){const[a,b]=expr.split('<=');return ev(a,e)<=ev(b,e)}
      if(expr.includes('>')&&!expr.includes('>=')){const[a,b]=expr.split('>');return ev(a,e)>ev(b,e)}
      if(expr.includes('<')&&!expr.includes('<=')){const[a,b]=expr.split('<');return ev(a,e)<ev(b,e)}
      return expr;
    };
    const pyStr=(v)=>{
      if(v===null||v===undefined)return'None';if(v===true)return'True';if(v===false)return'False';
      if(Array.isArray(v))return'['+v.map(x=>typeof x==='string'?"'"+x+"'":pyStr(x)).join(', ')+']';
      if(v instanceof Set)return'{'+[...v].map(x=>typeof x==='string'?"'"+x+"'":pyStr(x)).join(', ')+'}';
      if(typeof v==='object')return'{'+Object.entries(v).map(([k,val])=>(typeof k==='string'?"'"+k+"'":k)+': '+(typeof val==='string'?"'"+val+"'":pyStr(val))).join(', ')+'}';
      return String(v);
    };
    const run=(lines,e,depth=0)=>{
      let i=0;while(i<lines.length){
        const line=lines[i];const trimmed=line.trim();if(!trimmed){i++;continue}
        const pr=trimmed.match(/^print\((.+)\)$/s);
        if(pr){
          const args=[];let arg='';let paren=0;let inStr=false;let strCh='';
          for(const ch of pr[1]){if(!inStr&&(ch==="'"||ch==='"')){inStr=true;strCh=ch;arg+=ch}else if(inStr&&ch===strCh){inStr=false;arg+=ch}else if(!inStr&&ch==='('){paren++;arg+=ch}else if(!inStr&&ch===')'){paren--;arg+=ch}else if(!inStr&&ch===','&&paren===0){args.push(arg.trim());arg=''}else{arg+=ch}}
          if(arg.trim())args.push(arg.trim());
          const vals=args.map(a=>ev(a,e));out.push(vals.map(v=>typeof v==='string'?v:pyStr(v)).join(' '));i++;continue;
        }
        const fl=trimmed.match(/^for\s+(\w+)\s+in\s+(.+):$/);
        if(fl){const varN=fl[1];const iter=ev(fl[2],e);const body=[];i++;while(i<lines.length&&(lines[i].startsWith('    ')||lines[i].startsWith('\t'))){body.push(lines[i].replace(/^    /,'').replace(/^\t/,''));i++}if(Array.isArray(iter)||typeof iter==='string'){for(const item of iter){e[varN]=item;run(body,e,depth+1)}}continue;}
        const wl=trimmed.match(/^while\s+(.+):$/);
        if(wl){const body=[];i++;while(i<lines.length&&(lines[i].startsWith('    ')||lines[i].startsWith('\t'))){body.push(lines[i].replace(/^    /,'').replace(/^\t/,''));i++}let safety=1000;while(ev(wl[1],e)&&safety-->0){run(body,e,depth+1)}continue;}
        const ifm=trimmed.match(/^if\s+(.+):$/);
        if(ifm){const branches=[];const body=[];i++;while(i<lines.length&&(lines[i].startsWith('    ')||lines[i].startsWith('\t'))){body.push(lines[i].replace(/^    /,'').replace(/^\t/,''));i++}branches.push({cond:ifm[1],body:[...body]});while(i<lines.length){const el=lines[i].trim().match(/^elif\s+(.+):$/);if(el){const b2=[];i++;while(i<lines.length&&(lines[i].startsWith('    ')||lines[i].startsWith('\t'))){b2.push(lines[i].replace(/^    /,'').replace(/^\t/,''));i++}branches.push({cond:el[1],body:b2});continue}if(lines[i].trim()==='else:'){const b2=[];i++;while(i<lines.length&&(lines[i].startsWith('    ')||lines[i].startsWith('\t'))){b2.push(lines[i].replace(/^    /,'').replace(/^\t/,''));i++}branches.push({cond:'True',body:b2});continue}break;}for(const br of branches){if(ev(br.cond,e)){run(br.body,e,depth+1);break}}continue;}
        if(trimmed.startsWith('def ')){const dm=trimmed.match(/^def\s+(\w+)\(([^)]*)\):$/);if(dm){const fname=dm[1];const params=dm[2].split(',').map(p=>p.trim()).filter(Boolean);const body=[];i++;while(i<lines.length&&(lines[i].startsWith('    ')||lines[i].startsWith('\t'))){body.push(lines[i].replace(/^    /,'').replace(/^\t/,''));i++}e[fname]=(...args)=>{const le={...e};params.forEach((p,idx)=>{const[pn,pd]=p.split('=');le[pn.trim()]=idx<args.length?args[idx]:(pd?ev(pd.trim(),le):undefined)});let ret;for(const bl of body){const rt=bl.trim().match(/^return\s+(.+)$/);if(rt){ret=ev(rt[1],le);break}const fp=bl.trim().match(/^print\((.+)\)$/s);if(fp){const v=ev(fp[1],le);out.push(typeof v==='string'?v:pyStr(v));continue}const fa=bl.trim().match(/^(\w+)\s*=\s*(.+)$/);if(fa){le[fa[1]]=ev(fa[2],le)}}return ret};continue;}}
        if(trimmed.startsWith('import ')||trimmed.startsWith('from ')){i++;continue}
        if(trimmed==='try:'){const tbody=[];i++;while(i<lines.length&&(lines[i].startsWith('    ')||lines[i].startsWith('\t'))&&!lines[i].trim().startsWith('except')){tbody.push(lines[i].replace(/^    /,'').replace(/^\t/,''));i++}const ecatch=lines[i]?.trim().match(/^except\s*(.*):$/);const ebody=[];if(ecatch){i++;while(i<lines.length&&(lines[i].startsWith('    ')||lines[i].startsWith('\t'))){ebody.push(lines[i].replace(/^    /,'').replace(/^\t/,''));i++}}try{run(tbody,e,depth+1)}catch(err){run(ebody,e,depth+1)}continue;}
        if(trimmed.startsWith('raise ')){const rm=trimmed.match(/^raise\s+(\w+)\((.+)\)$/);if(rm)throw new Error(ev(rm[2],e));i++;continue;}
        const aug=trimmed.match(/^(\w+)\s*([\+\-\*\/])=\s*(.+)$/);
        if(aug){const cur=e[aug[1]]||0;const val=ev(aug[3],e);if(aug[2]==='+')e[aug[1]]=typeof cur==='string'?cur+val:cur+val;else if(aug[2]==='-')e[aug[1]]=cur-val;else if(aug[2]==='*')e[aug[1]]=cur*val;else if(aug[2]==='/')e[aug[1]]=cur/val;i++;continue}
        const asg=trimmed.match(/^(\w+)\s*=\s*(.+)$/);
        if(asg){e[asg[1]]=ev(asg[2],e);i++;continue}
        const da=trimmed.match(/^(\w+)\[(.+)\]\s*=\s*(.+)$/);
        if(da){const o=e[da[1]];const k=ev(da[2],e);o[k]=ev(da[3],e);i++;continue}
        const mc2=trimmed.match(/^(\w+)\.(\w+)\((.*)?\)$/);
        if(mc2){const obj=e[mc2[1]];const meth=mc2[2];const args=mc2[3]?[ev(mc2[3],e)]:[];if(Array.isArray(obj)&&meth==='append')obj.push(args[0]);if(typeof obj==='object'&&obj&&typeof obj[meth]==='function')obj[meth](...args);i++;continue}
        const fca=trimmed.match(/^(\w+)\s*=\s*(\w+)\(([^)]*)\)$/);
        if(fca&&typeof e[fca[2]]==='function'){const args=fca[3]?fca[3].split(',').map(a=>ev(a.trim(),e)):[];e[fca[1]]=e[fca[2]](...args);i++;continue}
        const bfc=trimmed.match(/^(\w+)\((.*)?\)$/);
        if(bfc&&typeof e[bfc[1]]==='function'){const args=bfc[2]?bfc[2].split(',').map(a=>ev(a.trim(),e)):[];e[bfc[1]](...args);i++;continue}
        if(trimmed.includes('.')&&trimmed.includes('(')){try{ev(trimmed,e)}catch{}i++;continue}
        i++;
      }
    };
    run(lines,env);return out.join('\n');
  }catch(err){return null;}
};

const offlineTips=(userCode,exercise)=>{
  const best=exercise.solutions.find(s=>s.best);if(!best)return'';
  const uc=userCode.trim();const bc=best.code.trim();if(uc===bc)return'';
  const tips=[];
  if(!uc)tips.push('Write some code to solve the exercise.');
  else if(!uc.includes('print'))tips.push('Don\'t forget to print() your result.');
  return tips.join(' ');
};


// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAIN APP COMPONENT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const App=()=>{
  const[lang,setLang]=useState(()=>localStorage.getItem('ql-lang')||'en');
  const[cIdx,setCIdx]=useState(null);
  const[cT,setCT]=useState(0);
  const[cE,setCE]=useState(0);
  const[tab,setTab]=useState('learn');
  const[lIdx,setLIdx]=useState(0);
  const[code,setCode]=useState('');
  const[output,setOutput]=useState('');
  const[hint,setHint]=useState('');
  const[showSol,setShowSol]=useState(false);
  const[solIdx,setSolIdx]=useState(0);
  const[done,setDone]=useState(()=>JSON.parse(localStorage.getItem('ql-done')||'{}'));
  const[apiKey,setApiKey]=useState(getKey());
  const[keyInput,setKeyInput]=useState('');
  const[showSettings,setShowSettings]=useState(false);
  const[chatOn,setChatOn]=useState(false);
  const[msgs,setMsgs]=useState([]);
  const[chatIn,setChatIn]=useState('');
  const[chatLD,setChatLD]=useState(false);
  const[showEn,setShowEn]=useState(true);
  const[transCache,setTransCache]=useState({});
  const[transing,setTransing]=useState(false);
  const chatRef=useRef(null);

  useEffect(()=>{localStorage.setItem('ql-lang',lang)},[lang]);
  useEffect(()=>{localStorage.setItem('ql-done',JSON.stringify(done))},[done]);
  useEffect(()=>{chatRef.current?.scrollIntoView({behavior:'smooth'})},[msgs]);

  const ui=UI[lang]||UI.en;
  const course=cIdx!==null?COURSES[cIdx]:null;
  const topics=course?.topics||[];
  const topic=topics[cT];
  const ex=topic?.exercises?.[cE];
  const courseColor=course?.color||'#10b981';

  useEffect(()=>{if(ex)setCode(ex.starterCode||'')},[cE,cT,cIdx]);

  const markDone=(topicId,exIdx)=>{const k=`${topicId}-${exIdx}`;setDone(d=>({...d,[k]:true}))};
  const isDone=(topicId,exIdx)=>!!done[`${topicId}-${exIdx}`];
  const tProg=(ti)=>{const t=topics[ti];if(!t?.exercises?.length)return 0;const d=t.exercises.filter((_,i)=>isDone(t.id,i)).length;return d/t.exercises.length};
  const oProg=()=>{if(!topics.length)return 0;return topics.reduce((s,_,i)=>s+tProg(i),0)/topics.length};

  const runCode=()=>{
    setShowSol(false);setHint('');
    const result=simPython(code);
    if(result!==null){
      setOutput(result);
      if(ex&&result.trim()===ex.expectedOutput?.trim()){markDone(topic.id,cE);setOutput(ui.correct+'\n'+result)}
      else if(ex){const tip=offlineTips(code,ex);setOutput(ui.wrong+'\n'+ui.yourOut+': '+result+(ex.expectedOutput?'\n'+ui.expected+': '+ex.expectedOutput:'')+(tip?'\n'+ui.tip+' '+tip:''))}
    }else{setOutput('Could not simulate. Use the hint button!')}
  };

  const saveKey=()=>{if(keyInput.trim()){localStorage.setItem('ql-api-key',keyInput.trim());setApiKey(keyInput.trim());setShowSettings(false)}};
  const clearKey=()=>{localStorage.removeItem('ql-api-key');setApiKey('');setKeyInput('')};

  const chat=async()=>{
    if(!chatIn.trim()||chatLD)return;const m=chatIn.trim();setChatIn('');setChatLD(true);
    setMsgs(p=>[...p,{role:'user',content:m}]);
    try{
      const ctx=`You are a helpful quantitative trading tutor. The student is learning quantitative trading with Python. Current topic: ${topic?.title}.${tab==='practice'&&ex?` Current exercise: ${ex?.title} â€” ${ex?.task}. Their code:\n\`\`\`python\n${code}\n\`\`\`` : tab==='learn'?` Currently reading lesson: ${topic?.lessons?.[lIdx]?.title}.`:''}\nAnswer in ${LANGS.find(l=>l.code===lang)?.label||'English'}. Be concise, helpful, encouraging. If they're stuck on an exercise, give a small hint, not the full answer.`;
      const res=await callAPI({model:'claude-sonnet-4-20250514',max_tokens:500,system:ctx,messages:[...msgs,{role:'user',content:m}].map(({role,content})=>({role,content}))});
      const reply=res.content?.[0]?.text||ui.fail;
      setMsgs(p=>[...p,{role:'assistant',content:reply}]);
    }catch{setMsgs(p=>[...p,{role:'assistant',content:ui.fail}])}
    setChatLD(false);
  };

  // â”€â”€ Dynamic content translation via API â”€â”€
  const translateText=async(text,key)=>{
    if(!text||lang==='en'||!apiKey)return text;
    const ck=`${lang}:${key}`;
    if(transCache[ck])return transCache[ck];
    setTransing(true);
    try{
      const langName=LANGS.find(l=>l.code===lang)?.label||lang;
      const res=await callAPI({model:'claude-sonnet-4-20250514',max_tokens:2000,system:`You are a translator. Translate the following educational content about quantitative trading from English to ${langName}. Keep all code blocks, variable names, function names, and technical terms (like pandas, numpy, matplotlib, yfinance, OHLCV, SMA, EMA, RSI, MACD, Sharpe ratio etc.) in English. Keep markdown formatting intact. Only output the translation, nothing else.`,messages:[{role:'user',content:text}]});
      const translated=res.content?.[0]?.text||text;
      setTransCache(c=>({...c,[ck]:translated}));
      setTransing(false);
      return translated;
    }catch{setTransing(false);return text}
  };

  const[transLesson,setTransLesson]=useState('');
  const[transExTask,setTransExTask]=useState('');
  const[transExTitle,setTransExTitle]=useState('');

  // Auto-translate lesson content when language/lesson changes
  useEffect(()=>{
    setTransLesson('');setTransExTask('');setTransExTitle('');
    if(lang==='en'||!apiKey)return;
    const lesson=topic?.lessons?.[lIdx];
    if(lesson&&tab==='learn'){
      translateText(lesson.content,`lesson-${cIdx}-${cT}-${lIdx}`).then(t=>{if(t!==lesson.content)setTransLesson(t)});
    }
    if(ex&&tab==='practice'){
      translateText(ex.task,`task-${cIdx}-${cT}-${cE}`).then(t=>{if(t!==ex.task)setTransExTask(t)});
      translateText(ex.title,`extitle-${cIdx}-${cT}-${cE}`).then(t=>{if(t!==ex.title)setTransExTitle(t)});
    }
  },[lang,lIdx,cT,cIdx,cE,tab,apiKey]);

  // Helper: get translated course/topic text or fallback to English
  const tt=(key,fallback)=>preT(key,lang)||fallback;

  const renderContent=(text)=>{
    if(!text)return null;
    const parts=text.split(/(\[\[\[diagram:[^\]]+\]\]\]|```[\s\S]*?```|\*\*[^*]+\*\*|`[^`]+`|\n)/);
    return parts.map((p,i)=>{
      if(p.startsWith('[[[diagram:')){
        const inner=p.slice(11,-3);
        if(inner.startsWith('summary:')){const items=inner.slice(8).split('|||');return <DiagramSummary key={i} items={items}/>}
        const D=Diagrams[inner];return D?<D key={i}/>:null;
      }
      if(p.startsWith('```')){const lines=p.split('\n');const code=lines.slice(1,-1).join('\n');return <pre key={i} style={{background:'#0a0f1e',borderRadius:8,padding:14,margin:'12px 0',overflowX:'auto',fontSize:12,fontFamily:'"Fira Code",monospace',lineHeight:1.6,border:'1px solid #1e293b',color:'#e2e8f0'}}>{code}</pre>}
      if(p.startsWith('**')&&p.endsWith('**'))return <strong key={i} style={{color:'#f1f5f9'}}>{p.slice(2,-2)}</strong>;
      if(p.startsWith('`')&&p.endsWith('`'))return <code key={i} style={{background:'rgba(16,185,129,0.15)',color:'#6ee7b7',padding:'2px 6px',borderRadius:4,fontSize:'0.9em',fontFamily:'monospace'}}>{p.slice(1,-1)}</code>;
      if(p==='\n')return <br key={i}/>;
      if(p.startsWith('â€¢ '))return <div key={i} style={{paddingLeft:16,position:'relative',marginBottom:2}}><span style={{position:'absolute',left:4,color:'#10b981'}}>â€¢</span>{p.slice(2)}</div>;
      return <span key={i}>{p}</span>;
    });
  };

  const C={
    btn:{padding:'8px 16px',borderRadius:8,border:'none',cursor:'pointer',fontWeight:600,fontSize:13,color:'#fff',transition:'all 0.2s'},
    btn2:{padding:'8px 16px',borderRadius:8,border:'1px solid #334155',cursor:'pointer',fontWeight:500,fontSize:13,color:'#94a3b8',background:'transparent'},
    card:{background:'rgba(16,24,48,0.6)',borderRadius:12,border:'1px solid #1e293b',padding:16,cursor:'pointer',transition:'all 0.3s'},
    fb:{display:'flex',alignItems:'center',justifyContent:'space-between'},
    fc:{display:'flex',alignItems:'center'},
    ed:{width:'100%',minHeight:180,background:'#0a0f1e',color:'#e2e8f0',fontFamily:'"Fira Code",monospace',fontSize:13,padding:14,borderRadius:8,border:'1px solid #1e293b',outline:'none',resize:'vertical',lineHeight:1.6,tabSize:4}
  };

  // â”€â”€â”€ COURSE LIST PAGE â”€â”€â”€
  if(cIdx===null)return(<div style={{maxWidth:1100,margin:'0 auto',padding:'20px 16px'}}>
    {/* Header */}
    <div style={{textAlign:'center',padding:'40px 0 30px'}}>
      <div style={{fontSize:48,marginBottom:8}}>ğŸ“ˆ</div>
      <h1 style={{fontSize:28,fontWeight:800,background:'linear-gradient(135deg,#10b981,#60a5fa)',WebkitBackgroundClip:'text',WebkitTextFillColor:'transparent',marginBottom:8}}>QuantLingo</h1>
      <p style={{color:'#94a3b8',fontSize:14}}>Python Quantitative Trading â€” from zero to strategy builder</p>
      <div style={{display:'flex',gap:8,justifyContent:'center',marginTop:16,flexWrap:'wrap'}}>
        {LANGS.map(l=><button key={l.code} onClick={()=>setLang(l.code)} style={{padding:'4px 10px',borderRadius:6,border:lang===l.code?'2px solid #10b981':'1px solid #1e293b',background:lang===l.code?'rgba(16,185,129,0.15)':'transparent',color:lang===l.code?'#6ee7b7':'#64748b',cursor:'pointer',fontSize:12}}>{l.flag} {l.label}</button>)}
        <button onClick={()=>{setKeyInput(apiKey);setShowSettings(true)}} style={{padding:'4px 10px',borderRadius:6,border:'1px solid #1e293b',background:'transparent',color:apiKey?'#10b981':'#64748b',cursor:'pointer',fontSize:12}}>{apiKey?'ğŸ”‘ API âœ“':'âš™ï¸ API Key'}</button>
      </div>
    </div>

    {/* Course Cards */}
    <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(280px,1fr))',gap:16}}>
      {COURSES.map((c,i)=>{
        const prog=cIdx===i?oProg():0;
        return <div key={c.id} onClick={()=>{setCIdx(i);setCT(0);setCE(0);setTab('learn');setLIdx(0)}} style={{...C.card,borderColor:c.color+'30',position:'relative',overflow:'hidden'}}>
          <div style={{position:'absolute',top:0,left:0,right:0,height:3,background:c.color,opacity:0.6}}/>
          <div style={{fontSize:32,marginBottom:8}}>{c.icon}</div>
          <h3 style={{color:'#f1f5f9',fontSize:16,fontWeight:700,marginBottom:6}}>{tt(`c:${i}:title`,c.title)}</h3>
          <p style={{color:'#94a3b8',fontSize:12,lineHeight:1.5,marginBottom:12}}>{tt(`c:${i}:desc`,c.desc)}</p>
          <div style={{display:'flex',alignItems:'center',gap:8}}>
            <div style={{flex:1,height:4,background:'#1e293b',borderRadius:2,overflow:'hidden'}}>
              <div style={{width:0+'%',height:'100%',background:c.color,borderRadius:2}}/>
            </div>
            <span style={{color:'#64748b',fontSize:11}}>{c.topics.length} topics</span>
          </div>
        </div>
      })}
    </div>

    {/* Settings Modal */}
    {showSettings&&<div style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.7)',zIndex:60,display:'flex',alignItems:'center',justifyContent:'center',padding:16}} onClick={e=>e.target===e.currentTarget&&setShowSettings(false)}>
      <div style={{background:'#0a0f1e',borderRadius:16,border:'1px solid #1e3a5f',padding:24,maxWidth:460,width:'100%',boxShadow:'0 12px 40px rgba(0,0,0,0.6)'}}>
        <div style={{...C.fb,marginBottom:20}}><h3 style={{fontSize:18,fontWeight:700,color:'#f1f5f9'}}>âš™ï¸ API Key Settings</h3><button onClick={()=>setShowSettings(false)} style={{background:'none',border:'none',color:'#64748b',cursor:'pointer',fontSize:20}}>Ã—</button></div>
        <p style={{color:'#94a3b8',fontSize:13,marginBottom:16,lineHeight:1.6}}>
          {lang==='zh'?'è¾“å…¥ä½ çš„ Anthropic API Key æ¥å¯ç”¨ AI å¯¼å¸ˆå’Œå†…å®¹ç¿»è¯‘ã€‚':'Enter your Anthropic API Key to enable AI Tutor and content translation.'}
          <br/><a href="https://console.anthropic.com/" target="_blank" style={{color:'#10b981'}}>â†’ console.anthropic.com</a>
          <br/><span style={{color:'#64748b',fontSize:11}}>{lang==='zh'?'Key ä»…å­˜å‚¨åœ¨ä½ çš„æµè§ˆå™¨ä¸­ï¼Œä¸ä¼šå‘é€åˆ°ä»»ä½•æœåŠ¡å™¨ã€‚':'Key is stored only in your browser.'}</span>
        </p>
        <div style={{display:'flex',gap:8,marginBottom:12}}>
          <input type="password" value={keyInput} onChange={e=>setKeyInput(e.target.value)} placeholder="sk-ant-..." onKeyDown={e=>{if(e.key==='Enter')saveKey()}} style={{flex:1,background:'#111827',color:'#e2e8f0',fontSize:13,padding:'10px 14px',borderRadius:8,border:'1px solid #1e293b',outline:'none',fontFamily:'monospace'}}/>
          <button onClick={saveKey} disabled={!keyInput.trim()} style={{...C.btn,padding:'10px 18px',background:'#10b981',opacity:keyInput.trim()?1:0.4}}>Save</button>
        </div>
        {apiKey&&<div style={{...C.fc,gap:8}}>
          <span style={{color:'#10b981',fontSize:12}}>âœ“ Key saved: {apiKey.slice(0,12)}...</span>
          <button onClick={clearKey} style={{color:'#f87171',fontSize:12,background:'none',border:'none',cursor:'pointer',textDecoration:'underline'}}>Remove</button>
        </div>}
      </div>
    </div>}
  </div>);

  // â”€â”€â”€ COURSE VIEW â”€â”€â”€
  return(<div style={{maxWidth:1100,margin:'0 auto',padding:'12px 16px'}}>
    {/* Top nav */}
    <div style={{...C.fb,marginBottom:16,flexWrap:'wrap',gap:8}}>
      <button onClick={()=>setCIdx(null)} style={{...C.btn2,display:'flex',alignItems:'center',gap:6}}><I n="Left" s={14}/>{ui.back}</button>
      <div style={{...C.fc,gap:8}}>
        <select value={lang} onChange={e=>setLang(e.target.value)} style={{background:'#111827',color:'#e2e8f0',border:'1px solid #1e293b',borderRadius:6,padding:'4px 8px',fontSize:12}}>
          {LANGS.map(l=><option key={l.code} value={l.code}>{l.flag} {l.label}</option>)}
        </select>
        <button onClick={()=>{setKeyInput(apiKey);setShowSettings(true)}} style={{background:'none',border:'1px solid #1e293b',borderRadius:6,padding:'4px 8px',color:apiKey?'#10b981':'#64748b',cursor:'pointer',fontSize:12}}>
          {apiKey?'ğŸ”‘':'âš™ï¸'}
        </button>
      </div>
    </div>

    {/* Course header */}
    <div style={{marginBottom:16,padding:16,borderRadius:12,background:`linear-gradient(135deg,${courseColor}15,${courseColor}05)`,border:`1px solid ${courseColor}30`}}>
      <div style={{...C.fc,gap:12}}>
        <span style={{fontSize:28}}>{course.icon}</span>
        <div>
          <h2 style={{color:'#f1f5f9',fontSize:18,fontWeight:700}}>{tt(`c:${cIdx}:title`,course.title)}</h2>
          <p style={{color:'#94a3b8',fontSize:12}}>{tt(`c:${cIdx}:desc`,course.desc)}</p>
        </div>
      </div>
      {/* Progress */}
      <div style={{marginTop:12,display:'flex',alignItems:'center',gap:8}}>
        <div style={{flex:1,height:4,background:'#1e293b',borderRadius:2,overflow:'hidden'}}>
          <div style={{width:oProg()*100+'%',height:'100%',background:courseColor,borderRadius:2,transition:'width 0.5s'}}/>
        </div>
        <span style={{color:'#64748b',fontSize:11}}>{Math.round(oProg()*100)}%</span>
      </div>
    </div>

    {/* Topic selector */}
    <div style={{display:'flex',gap:6,overflowX:'auto',paddingBottom:8,marginBottom:16}}>
      {topics.map((t,i)=>{const p=tProg(i);return <button key={t.id} onClick={()=>{setCT(i);setCE(0);setTab('learn');setLIdx(0)}} style={{flexShrink:0,padding:'8px 14px',borderRadius:8,border:cT===i?`2px solid ${courseColor}`:'1px solid #1e293b',background:cT===i?courseColor+'20':'transparent',color:cT===i?'#f1f5f9':'#94a3b8',cursor:'pointer',fontSize:12,fontWeight:cT===i?600:400,display:'flex',alignItems:'center',gap:6}}>
        <span>{t.icon}</span>
        <span>{tt(`t:${cIdx}:${i}:title`,t.title)}</span>
        {p>=1&&<span style={{color:'#10b981'}}>âœ“</span>}
      </button>})}
    </div>

    {/* Tabs */}
    {topic&&<div style={{display:'flex',gap:4,marginBottom:16}}>
      {['learn','practice'].map(t=><button key={t} onClick={()=>setTab(t)} style={{padding:'8px 20px',borderRadius:8,border:'none',cursor:'pointer',background:tab===t?courseColor:'transparent',color:tab===t?'#fff':'#64748b',fontWeight:600,fontSize:13,transition:'all 0.2s'}}>{t==='learn'?ui.learn:ui.practice}</button>)}
    </div>}

    {/* Learn tab */}
    {topic&&tab==='learn'&&<main>
      {/* Lesson nav */}
      <div style={{display:'flex',gap:4,marginBottom:16,flexWrap:'wrap'}}>
        {topic.lessons.map((l,i)=><button key={i} onClick={()=>setLIdx(i)} style={{padding:'6px 14px',borderRadius:6,border:lIdx===i?`1px solid ${courseColor}`:'1px solid #1e293b',background:lIdx===i?courseColor+'15':'transparent',color:lIdx===i?'#f1f5f9':'#94a3b8',cursor:'pointer',fontSize:12}}>{l.title}</button>)}
      </div>
      {/* Lesson content */}
      <div style={{background:'rgba(16,24,48,0.4)',borderRadius:12,border:'1px solid #1e293b',padding:20,lineHeight:1.8,fontSize:14,color:'#cbd5e1'}}>
        <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:16}}>
          <h3 style={{color:'#f1f5f9',fontSize:18,fontWeight:700}}>{topic.lessons[lIdx]?.title}</h3>
          <div style={{display:'flex',gap:6}}>
            {lang!=='en'&&apiKey&&<button onClick={()=>setShowEn(!showEn)} style={{padding:'4px 10px',borderRadius:6,border:'1px solid #1e293b',background:showEn?'rgba(16,185,129,0.15)':'transparent',color:showEn?'#6ee7b7':'#64748b',cursor:'pointer',fontSize:11}}>{showEn?ui.hideEn:ui.showEn}</button>}
            <button onClick={()=>setChatOn(true)} style={{padding:'4px 10px',borderRadius:6,border:'1px solid #1e293b',background:'transparent',color:courseColor,cursor:'pointer',fontSize:11,display:'flex',alignItems:'center',gap:4}}><I n="Chat" s={12}/> {ui.tutor}</button>
          </div>
        </div>
        {transing&&<div style={{padding:8,borderRadius:6,background:'rgba(251,191,36,0.1)',border:'1px solid rgba(251,191,36,0.2)',color:'#fbbf24',fontSize:12,marginBottom:12,textAlign:'center'}} className="pulse">{ui.transing}</div>}
        {lang!=='en'&&transLesson&&<div style={{marginBottom:16,paddingBottom:16,borderBottom:'1px solid #1e293b'}}>
          {renderContent(transLesson)}
        </div>}
        {(lang==='en'||(showEn&&lang!=='en'))&&<div style={{opacity:lang!=='en'?0.6:1}}>
          {lang!=='en'&&<div style={{color:'#64748b',fontSize:11,marginBottom:8}}>ğŸ‡¬ğŸ‡§ English Original:</div>}
          {renderContent(topic.lessons[lIdx]?.content)}
        </div>}
        {lang!=='en'&&!transLesson&&!transing&&!apiKey&&<div>{renderContent(topic.lessons[lIdx]?.content)}</div>}
      </div>
      {/* Nav buttons */}
      <div style={{marginTop:16,display:'flex',justifyContent:'space-between'}}>
        <button onClick={()=>lIdx>0&&setLIdx(lIdx-1)} disabled={lIdx===0} style={{...C.btn2,opacity:lIdx===0?0.3:1}}>{ui.prev}</button>
        {lIdx<topic.lessons.length-1?<button onClick={()=>setLIdx(lIdx+1)} style={{...C.btn,background:courseColor}}>{ui.next}</button>
          :<button onClick={()=>setTab('practice')} style={{...C.btn,background:courseColor}}>{ui.startEx}</button>}
      </div>
    </main>}

    {/* Practice tab */}
    {topic&&tab==='practice'&&ex&&<main>
      {/* Exercise header */}
      <div style={{background:'rgba(16,24,48,0.4)',borderRadius:12,border:'1px solid #1e293b',padding:16,marginBottom:16}}>
        <div style={{...C.fb}}>
          <h3 style={{color:'#f1f5f9',fontSize:15,fontWeight:700}}>{transExTitle||ex.title}</h3>
          <span style={{color:isDone(topic.id,cE)?'#10b981':'#64748b',fontSize:12}}>{isDone(topic.id,cE)?'âœ… Done':'â¬œ Todo'}</span>
        </div>
        <p style={{color:'#94a3b8',fontSize:13,marginTop:8}}>{transExTask||ex.task}</p>
        {lang!=='en'&&transExTask&&<p style={{color:'#64748b',fontSize:11,marginTop:4}}>ğŸ‡¬ğŸ‡§ {ex.task}</p>}
      </div>

      {/* Editor + Output */}
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:12}} className="g2">
        {/* Code editor */}
        <div>
          <div style={{...C.fb,marginBottom:6}}>
            <span style={{color:'#64748b',fontSize:11}}>Python Editor</span>
            <div style={{display:'flex',gap:4}}>
              <button onClick={runCode} style={{...C.btn,padding:'4px 12px',background:courseColor,fontSize:11}}><I n="Play" s={12}/> {ui.run}</button>
              <button onClick={()=>{setCode(ex.starterCode||'');setOutput('');setHint('');setShowSol(false)}} style={{...C.btn2,padding:'4px 10px',fontSize:11}}>{ui.reset}</button>
            </div>
          </div>
          <textarea value={code} onChange={e=>setCode(e.target.value)} style={C.ed} spellCheck={false} placeholder="Write your code here..."/>
        </div>

        {/* Output panel */}
        <div>
          <div style={{...C.fb,marginBottom:6}}>
            <span style={{color:'#64748b',fontSize:11}}>Output</span>
            <div style={{display:'flex',gap:4}}>
              <button onClick={()=>{setHint(ex.hint||'');setShowSol(false)}} style={{...C.btn2,padding:'4px 10px',fontSize:11}}>{hint?ui.hide:ui.hint}</button>
              <button onClick={()=>{setShowSol(!showSol);setSolIdx(0)}} style={{...C.btn2,padding:'4px 10px',fontSize:11}}>{showSol?ui.hide:ui.viewSol}</button>
              <button onClick={()=>setChatOn(true)} style={{...C.btn2,padding:'4px 10px',fontSize:11,color:courseColor}}><I n="Chat" s={12}/></button>
            </div>
          </div>
          <div style={{background:'#0a0f1e',borderRadius:8,border:'1px solid #1e293b',padding:14,minHeight:180,fontFamily:'monospace',fontSize:13,whiteSpace:'pre-wrap',color:'#e2e8f0'}}>
            {output||<span style={{color:'#475569'}}>Click Run to see output...</span>}
          </div>
          {hint&&!showSol&&<div style={{marginTop:8,padding:10,borderRadius:8,background:'rgba(251,191,36,0.1)',border:'1px solid rgba(251,191,36,0.3)',color:'#fbbf24',fontSize:12}}>ğŸ’¡ {hint}</div>}
          {showSol&&<div style={{marginTop:8,padding:12,borderRadius:8,background:'rgba(16,185,129,0.1)',border:'1px solid rgba(16,185,129,0.3)'}}>
            <div style={{display:'flex',gap:4,marginBottom:8}}>{ex.solutions.map((s,i)=><button key={i} onClick={()=>setSolIdx(i)} style={{padding:'3px 10px',borderRadius:4,border:'none',background:solIdx===i?courseColor:'#1e293b',color:solIdx===i?'#fff':'#94a3b8',cursor:'pointer',fontSize:11}}>{s.label}</button>)}</div>
            <pre style={{color:'#e2e8f0',fontSize:12,fontFamily:'monospace',lineHeight:1.5}}>{ex.solutions[solIdx]?.code}</pre>
            {ex.bestExplanation&&<p style={{color:'#94a3b8',fontSize:11,marginTop:8,paddingTop:8,borderTop:'1px solid #1e293b'}}>{ui.bestPractice} {ex.bestExplanation}</p>}
            <button onClick={()=>setCode(ex.solutions[solIdx]?.code)} style={{marginTop:8,padding:'4px 10px',borderRadius:4,border:'none',background:'#1e293b',color:'#94a3b8',cursor:'pointer',fontSize:11}}>{ui.copy}</button>
          </div>}
        </div>
      </div>

      {/* Exercise nav */}
      <div style={{marginTop:24,...C.fb}}>
        <button onClick={()=>cE>0&&setCE(cE-1)} disabled={cE===0} style={{...C.btn2,opacity:cE===0?0.3:1}}>{ui.prev}</button>
        <span style={{color:'#64748b',fontSize:12}}>{ui.ex} {cE+1} {ui.of} {topic.exercises.length}</span>
        {cE<topic.exercises.length-1?<button onClick={()=>{setCE(cE+1);setOutput('');setHint('');setShowSol(false)}} style={{...C.btn,background:courseColor}}>{ui.next}</button>
          :cT<topics.length-1&&tProg(cT)>=1?<button onClick={()=>{setCT(cT+1);setCE(0);setTab('learn');setLIdx(0)}} style={{...C.btn,background:courseColor}}>{ui.nextT}</button>
          :<span style={{color:'#64748b',fontSize:13}}>{ui.complete}</span>}
      </div>
    </main>}

    {/* Settings Modal */}
    {showSettings&&<div style={{position:'fixed',inset:0,background:'rgba(0,0,0,0.7)',zIndex:60,display:'flex',alignItems:'center',justifyContent:'center',padding:16}} onClick={e=>e.target===e.currentTarget&&setShowSettings(false)}>
      <div style={{background:'#0a0f1e',borderRadius:16,border:'1px solid #1e3a5f',padding:24,maxWidth:460,width:'100%',boxShadow:'0 12px 40px rgba(0,0,0,0.6)'}}>
        <div style={{...C.fb,marginBottom:20}}><h3 style={{fontSize:18,fontWeight:700,color:'#f1f5f9'}}>âš™ï¸ API Key Settings</h3><button onClick={()=>setShowSettings(false)} style={{background:'none',border:'none',color:'#64748b',cursor:'pointer',fontSize:20}}>Ã—</button></div>
        <p style={{color:'#94a3b8',fontSize:13,marginBottom:16,lineHeight:1.6}}>
          {lang==='zh'?'è¾“å…¥ä½ çš„ Anthropic API Key æ¥å¯ç”¨ AI å¯¼å¸ˆã€‚':'Enter your Anthropic API Key to enable AI Tutor.'}
          <br/><a href="https://console.anthropic.com/" target="_blank" style={{color:'#10b981'}}>â†’ console.anthropic.com</a>
        </p>
        <div style={{display:'flex',gap:8,marginBottom:12}}>
          <input type="password" value={keyInput} onChange={e=>setKeyInput(e.target.value)} placeholder="sk-ant-..." onKeyDown={e=>{if(e.key==='Enter')saveKey()}} style={{flex:1,background:'#111827',color:'#e2e8f0',fontSize:13,padding:'10px 14px',borderRadius:8,border:'1px solid #1e293b',outline:'none',fontFamily:'monospace'}}/>
          <button onClick={saveKey} disabled={!keyInput.trim()} style={{...C.btn,padding:'10px 18px',background:'#10b981',opacity:keyInput.trim()?1:0.4}}>Save</button>
        </div>
        {apiKey&&<div style={{...C.fc,gap:8}}>
          <span style={{color:'#10b981',fontSize:12}}>âœ“ Key saved: {apiKey.slice(0,12)}...</span>
          <button onClick={clearKey} style={{color:'#f87171',fontSize:12,background:'none',border:'none',cursor:'pointer',textDecoration:'underline'}}>Remove</button>
        </div>}
      </div>
    </div>}

    {/* Floating AI Tutor Button */}
    {!chatOn&&apiKey&&topic&&<button onClick={()=>setChatOn(true)} style={{position:'fixed',bottom:20,right:20,width:52,height:52,borderRadius:26,background:`linear-gradient(135deg,${courseColor},${courseColor}cc)`,border:'none',color:'#fff',cursor:'pointer',boxShadow:'0 4px 20px rgba(0,0,0,0.4)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:40,transition:'transform 0.2s'}} onMouseOver={e=>e.currentTarget.style.transform='scale(1.1)'} onMouseOut={e=>e.currentTarget.style.transform='scale(1)'}><I n="Chat" s={22}/></button>}

    {/* AI Tutor Chat */}
    {chatOn&&topic&&<div style={{position:'fixed',bottom:16,right:16,width:380,height:480,background:'#0a0f1e',borderRadius:12,border:`1px solid ${courseColor}40`,boxShadow:'0 8px 32px rgba(0,0,0,0.5)',display:'flex',flexDirection:'column',zIndex:50}}>
      <div style={{...C.fb,padding:12,borderBottom:'1px solid #1e293b'}}><div style={{...C.fc,gap:8}}><I n="Chat" s={14}/><span style={{fontWeight:600,color:courseColor,fontSize:14}}>{ui.tutor}</span></div><button onClick={()=>setChatOn(false)} style={{background:'none',border:'none',color:'#64748b',cursor:'pointer'}}><I n="X" s={14}/></button></div>
      {!apiKey?<div style={{flex:1,display:'flex',flexDirection:'column',alignItems:'center',justifyContent:'center',padding:24,textAlign:'center'}}>
        <div style={{fontSize:40,marginBottom:12}}>ğŸ”‘</div>
        <p style={{color:'#e2e8f0',fontSize:14,fontWeight:600,marginBottom:8}}>{lang==='zh'?'éœ€è¦ API Key':'API Key Required'}</p>
        <p style={{color:'#64748b',fontSize:12,marginBottom:16}}>{lang==='zh'?'AI å¯¼å¸ˆéœ€è¦ Anthropic API Keyã€‚':'AI Tutor requires an Anthropic API Key.'}</p>
        <button onClick={()=>{setKeyInput('');setShowSettings(true)}} style={{...C.btn,padding:'8px 20px',background:'#10b981',fontSize:13}}>âš™ï¸ {lang==='zh'?'è®¾ç½® API Key':'Set API Key'}</button>
      </div>
      :<>
      <div style={{flex:1,overflowY:'auto',padding:12,display:'flex',flexDirection:'column',gap:8}}>
        {msgs.map((m,i)=><div key={i} style={{display:'flex',justifyContent:m.role==='user'?'flex-end':'flex-start'}}><div style={{maxWidth:'85%',padding:'8px 12px',borderRadius:8,fontSize:13,whiteSpace:'pre-wrap',background:m.role==='user'?courseColor:'#111827',color:'#e2e8f0'}}>{m.content}</div></div>)}
        {chatLD&&<div style={{display:'flex'}}><div style={{background:'#111827',color:'#64748b',padding:'8px 12px',borderRadius:8,fontSize:13}} className="pulse">{ui.think}</div></div>}
        <div ref={chatRef}/>
      </div>
      <div style={{padding:12,borderTop:'1px solid #1e293b'}}><div style={{display:'flex',gap:8}}>
        <input value={chatIn} onChange={e=>setChatIn(e.target.value)} onKeyDown={e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();chat()}}} placeholder={ui.ask} style={{flex:1,background:'#111827',color:'#e2e8f0',fontSize:13,padding:'8px 12px',borderRadius:8,border:'1px solid #1e293b',outline:'none'}}/>
        <button onClick={chat} disabled={chatLD||!chatIn.trim()} style={{...C.btn,padding:8,background:courseColor,opacity:(chatLD||!chatIn.trim())?0.5:1}}><I n="Send" s={14}/></button>
      </div></div>
      </>}
    </div>}
  </div>);
};

ReactDOM.render(<App/>,document.getElementById('root'));
</script>
</body>
</html>
